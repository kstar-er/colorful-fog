"use strict";(self.webpackChunksystem=self.webpackChunksystem||[]).push([[2831,566,9653],{20566:function(e,l,a){a(57658),a(21703);var t=a(81081),o=a(82883);a(68521);const s=o.default["_state"];l.Z=class{constructor({modules:e="",selectUri:l="/",deleteUri:a="/",selectOneUri:t="/",pageSize:o=20,tableHeader:s=[]}={}){this.modules=e,this.selectUri=l,this.selectOneUri=t,this.deleteUri=a,this.searchData={},this.currentPage=1,this.pageSize=o,this.total=0,this.tableData=[],this.tableHeader=s,this.selections=[]}async initData(e=this,l){var{data:a,code:o}=(await t.K.post(`${e.selectUri}?pageNum=${e.currentPage}&pageSize=`+e.pageSize,e.searchData))["data"];200===o&&(e.total=a.total,e.tableData.length=0,e.tableData.push(...a.rows),l?.clearSelection())}currentPageChange(e,l=this,a){l.currentPage=e,l.initData(l,a)}pageSizeChange(e,l=this,a){l.currentPage=1,l.pageSize=e,l.initData(l,a)}search(e,l=this,a){l.searchData=e,l.currentPage=1,l.initData(l,a,!0)}async delete(e,l,a=this){var{code:e,message:o}=(await t.K.post(""+a.deleteUri,e))["data"];return 200===e?(a.initData(a,l),e):o}selectionChange(e,l=this){l.selections.length=0,l.selections.push(...e)}initTableHeader(e=this){if(0===e.tableHeader.length){if(0===e.modules.length||!s.data[e.modules])throw new Error("获取store中的表头, 请提供modules名");e.tableHeader.length=0,e.tableHeader.push(...s.data[e.modules].tableHeader.filter((e=>e.isShow)))}}async selectOne(e,l=this){l=(await t.K.post(l.selectOneUri+"?id="+e))["data"]["data"];return l}}},52001:function(e,l,a){a.d(l,{V:function(){return t.V},o:function(){return s}}),a(57658);var t=a(81081),o=(l=a(20566),a(68521));class s extends l.Z{constructor({modules:e="",selectUri:l="/",deleteUri:a="/",selectOneUri:t="/",pageSize:o=20,tableHeader:s}={}){super({modules:e,selectUri:l,deleteUri:a,selectOneUri:t,pageSize:o,tableHeader:s})}async initData(e=this,l){var{data:a,code:o}=(await t.K.post(`${e.selectUri}?currentPage=${e.currentPage}&pageSize=`+e.pageSize,e.searchData))["data"];200===o&&(e.total=a.pageInfo.total,e.tableData.length=0,e.tableData.push(...a.pageInfo.list),l?.clearSelection())}currentPageChange(e,l=this,a){l.currentPage=e,l.initData(l,a)}pageSizeChange(e,l=this,a){l.currentPage=1,l.pageSize=e,l.initData(l,a)}search(e,l=this,a){l.searchData=e,l.currentPage=1,l.initData(l,a,!0)}forMatData(e,l){return e&&l&&(-1!==e.indexOf("Time")||-1!==e.indexOf("Date"))?(new o.x).timeStamp2Time(l,"yyyy-MM-dd hh:mm:ss"):l&&0<l.toString().length||"number"==typeof l?l:"-"}async getReportData(e){var{code:e,data:l,msg:a}=(await t.K.post("/colorful-fog/RepoController/getData",e))["data"];return 200===e?{data:l,code:e}:a}async getSchemeHeader(e){var{code:e,data:l,msg:a}=(await t.K.post("/colorful-fog/billResult/list?currentPage=1&pageSize=1",e))["data"],l=[{resultName:"批次号",resultCode:"batchCode",resultType:"STRING"},{resultName:"状态",resultCode:"status",resultType:"STRING"},{resultName:"所属经销商",resultCode:"belongArchiveName",resultType:"STRING"},{resultName:"账单编码",resultCode:"billCode",resultType:"STRING"},{resultName:"账单类型",resultCode:"billType",resultType:"STRING"},{resultName:"账期",resultCode:"costTerm",resultType:"STRING"},...l.resultNameList];return 200===e?l:a}async getCollectHeader(e){var{code:e,data:l,msg:a}=(await t.K.post("/colorful-fog/CollectResultMain/list?currentPage=1&pageSize=1",e))["data"],l=[{resultName:"所属经销商",resultCode:"belongArchiveName",resultType:"STRING"},{resultName:"账单编码",resultCode:"billCode",resultType:"STRING"},{resultName:"账单类型",resultCode:"billType",resultType:"STRING"},{resultName:"账期",resultCode:"costTerm",resultType:"STRING"},...l.resultNameList];return 200===e?l:a}async saveReportJson(e){var{code:e,data:l,msg:a}=(await t.K.post("/colorful-fog/RepoController/saveRepoJson",e))["data"];return 200===e?{data:l,code:e}:a}async getRepoJson(e){var{code:e,data:l,msg:a}=(await t.K.post("/colorful-fog/RepoController/getRepoJson",e))["data"];return 200===e?{data:l,code:e}:a}}},52831:function(e,l,a){a.r(l),a.d(l,{default:function(){return b}}),a(57658);var t=a(73396),o=a(87139),s=a(44870),u=a(44385),r=a(88490),i=a(52001),d=a(81081);l=e=>((0,t.dD)("data-v-36a67764"),e=e(),(0,t.Cn)(),e);const c={class:"jx-dialog-header"},n=["id"],p=[l((()=>(0,t._)("h4",{class:"inline-block"}," 报表配置 ",-1)))],m=l((()=>(0,t._)("span",{class:"title-collapse"}," 报表详情 ",-1))),h={class:"demo-collapse"},g={class:"flex align-center"},v={class:"filterCriteria mt10"};l={__name:"settings",props:{isShow:{type:Boolean,default:!1},default:{type:Object,default:()=>({})}},emits:["closeDialog","submit","saveReportJSON"],setup(e,{emit:l}){const a=e,b=(0,s.iH)(new i.o),f=(0,s.iH)(!1),w=(0,s.qj)([]),y=(0,s.qj)([]),S=(0,s.qj)([]),D=[{label:"等于",value:"等于"},{label:"处于",value:"处于"}],C=[{label:"统计某月",value:"天"},{label:"统计某年",value:"月"}],T=(0,s.iH)(!1),V=(0,t.FN)()["proxy"],N=()=>l("closeDialog"),k=((0,t.YP)((()=>a.isShow),(()=>{a.isShow&&(w.length=0,y.length=0,S.length=0,U.value={...a.default},T.value=!T.value,U.value.sourceValue)&&(f.value=!0,"collectResult"!==U.value.sourceInterfaceName?b.value.getSchemeHeader({schemeCode:U.value.sourceValue}).then((e=>{A(e),j.isShow=!1})):b.value.getCollectHeader({collectSchemeCode:U.value.sourceValue}).then((e=>{A(e),j.isShow=!1})))}),{immediate:!0}),(0,t.Fl)({get(){return a.isShow},set(){}})),U=(0,s.iH)({xAxis:{fieldName:"",resultType:"",value:""},yAxis:{list:[],groupBy:""},filterCriteria:[]}),x=()=>{U.value.filterCriteria.push({})},R=e=>{U.value.xAxis.resultType=e.split("-")[2],"DATE"===U.value.xAxis.resultType?(S.length=0,S.push(...K.filter((e=>(e.label=e.resultName,e.value=e.resultName+"-"+e.resultCode+"-"+e.resultType,"DATE"!==e.resultType))))):(U.value.year=null,U.value.month=null,U.value.xaxisIsTime=!1,U.value.timeUnit="",U.value.compare.list.length=0)},H=e=>{},_=(0,s.qj)({isShow:!1,formInputEl:[{title:"报表名称",key:"title",element:"input",rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]},{title:"报表类型",key:"sourceInterfaceName",element:"radio",options:[{label:"普通账单",value:"billMain"},{label:"汇总账单",value:"collectResult"}],change:e=>{U.value.sourceInterfaceName=e,V.$refs.dialogForm.updateDialogInput({sourceValue:""}),f.value=!1},rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]},{title:"选择账单",key:"sourceValue",element:"input",type:"dialog",rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]}],formSelectEl:[{title:"报表类型",key:"chartsType",element:"check",options:[{label:"折线图 & 柱状图",value:"折线图 & 柱状图"},{label:"表格",value:"表格",disabled:!0},{label:"饼图",value:"饼图",disabled:!0}],rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]}],formTextAreaEl:[],emitOpenDialog:e=>{P(e,U.value.sourceInterfaceName)},inputDone:e=>{e={...U.value,...e},e.id||(e.id=V.$DataTool.randomString(10)),l("saveReportJSON",e)}}),I=(0,s.iH)(["1","2","3","4"]),z=e=>{},j=(0,s.qj)({isShow:!1,dataSource:null,searchPlaceholde:"",doSearch:e=>{},chooseRow:e=>{}}),A=e=>{K=e,w.length=0,y.length=0,S.length=0,e.forEach((e=>{e.label=e.resultName,e.value=e.resultName+"-"+e.resultCode+"-"+e.resultType,S.push(e),"STRING"!==e.resultType&&"DATE"!==e.resultType||w.push(e),"NUM"===e.resultType&&y.push(e)}))};let K=[];const P=async(e,l)=>{j.useChoose=!0,"sourceValue"===e&&(j.searchPlaceholde="输入账单计划名称进行搜索",j.chooseRow=e=>{e.children||(V.$refs.dialogForm.updateDialogInput({sourceValue:e.schemeCode??e.collectSchemeCode,sourceValueName:e.schemeName??e.collectSchemeName}),f.value=!0,"collectResult"!==l?b.value.getSchemeHeader({schemeCode:e.schemeCode}).then((e=>{A(e),j.isShow=!1})):b.value.getCollectHeader({collectSchemeCode:e.collectSchemeCode}).then((e=>{A(e),j.isShow=!1})))},j.doSearch=e=>{j.dataSource.searchData={},e&&(j.dataSource.searchData.name=e),j.dataSource.initData()},j.dataSource=new i.o({selectUri:"collectResult"===l?"/colorful-fog/collectSchemeMain/select":"/colorful-fog/schemeMain/selectMenu",tableHeader:"collectResult"===l?[{label:"账单名称",prop:"collectSchemeName",width:200},{label:"账单code",prop:"collectSchemeCode",width:200},{label:"账单描述",prop:"collectSchemeDesc",width:200}]:[{label:"账单名称",prop:"name",width:200},{label:"账单code",prop:"schemeCode",width:200},{label:"类型",prop:"billType",width:200}],pageSize:10}),j.dataSource.forMatData=(e,l)=>e[l.property]?"billType"===l.property?"PAY"===e[l.property]?"应付":"应收":e[l.property]??"-":"-","collectResult"!==l&&(j.dataSource.initData=async(e=j.dataSource)=>{var{data:e,code:l}=(await d.K.post(`${e.selectUri}?currentPage=${e.currentPage}&pageSize=`+e.pageSize,e.searchData))["data"];200===l&&(j.dataSource.tableData.length=0,l=Object.entries(e).reduce(((e,l,a)=>(l={name:l[0],children:l[1],id:a+1,schemeCode:"-"},e.push(l),e)),[]),j.dataSource.tableData.push(...l),j.dataSource.total=j.dataSource.tableData.length)}),await j.dataSource.initData(),j.isShow=!0)},W=(0,s.qj)([{label:"2024",value:2024},{label:"2025",value:2025},{label:"2026",value:2026}]),q=(0,s.qj)([{label:"一月",value:1},{label:"二月",value:2},{label:"三月",value:3},{label:"四月",value:4},{label:"五月",value:5},{label:"六月",value:6},{label:"七月",value:7},{label:"八月",value:8},{label:"九月",value:9},{label:"十月",value:10},{label:"十一月",value:11},{label:"十二月",value:12}]),E=e=>{"天"!==e&&delete U.value.month};return(e,l)=>{const a=(0,t.up)("el-button"),d=(0,t.up)("el-option"),b=(0,t.up)("el-select"),V=(0,t.up)("el-collapse-item"),A=(0,t.up)("el-date-picker"),K=(0,t.up)("el-input"),P=(0,t.up)("el-collapse");var O=(0,t.up)("el-dialog");return(0,t.wg)(),(0,t.iD)("div",null,[(0,t.Wm)(O,{modelValue:k.value,"onUpdate:modelValue":l[9]||(l[9]=e=>k.value=e),"lock-scroll":"","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,fullscreen:!1,width:"70%",top:"3%","destroy-on-close":""},{header:(0,t.w5)((({titleId:e,titleClass:l})=>[(0,t._)("div",c,[(0,t._)("div",{id:e,class:(0,o.C_)(l)},p,10,n),(0,t._)("div",null,[(0,t.Wm)(a,{class:"dialog-close-btn",type:"danger",icon:"CloseBold",circle:"",onClick:N})])])])),default:(0,t.w5)((()=>[(0,t.Wm)(u.Z,{ref:"dialogForm",loading:(0,s.SU)(i.V),width:"60%","form-data":U.value,"use-dialog":!1,title:"请填写相关信息","form-input-el":_.formInputEl,"form-select-el":_.formSelectEl,"form-text-area-el":_.formTextAreaEl,"form-upload-el":_.formUploadEl,"is-change":T.value,onCloseDialog:N,onEmitOpenDialog:_.emitOpenDialog,onInputDone:_.inputDone},(0,t.Nv)({_:2},[f.value?{name:"append",fn:(0,t.w5)((()=>[m,(0,t._)("div",h,[(0,t.Wm)(P,{modelValue:I.value,"onUpdate:modelValue":l[7]||(l[7]=e=>I.value=e),onChange:z},{default:(0,t.w5)((()=>[(0,t.Wm)(V,{title:"定义X轴",name:"1"},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{modelValue:U.value.xAxis.fieldName,"onUpdate:modelValue":l[0]||(l[0]=e=>U.value.xAxis.fieldName=e),style:{width:"220px"},filterable:"",placeholder:"请选择X轴","collapse-tags":"","collapse-tags-tooltip":"",class:"mr10",onChange:R},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(w,(e=>((0,t.wg)(),(0,t.j4)(d,{key:e.label,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),"DATE"===U.value.xAxis.resultType?((0,t.wg)(),(0,t.j4)(b,{key:0,modelValue:U.value.timeUnit,"onUpdate:modelValue":l[1]||(l[1]=e=>U.value.timeUnit=e),style:{width:"220px"},placeholder:"请选择统计时间","collapse-tags":"","collapse-tags-tooltip":"",class:"mr10",onChange:E},{default:(0,t.w5)((()=>[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(C,(e=>(0,t.Wm)(d,{key:e.label,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])):(0,t.kq)("",!0),"DATE"===U.value.xAxis.resultType?((0,t.wg)(),(0,t.j4)(b,{key:1,modelValue:U.value.year,"onUpdate:modelValue":l[2]||(l[2]=e=>U.value.year=e),style:{width:"220px"},placeholder:"请选择时间","collapse-tags":"","collapse-tags-tooltip":"",class:"mr10"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(W,(e=>((0,t.wg)(),(0,t.j4)(d,{key:e.label,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])):(0,t.kq)("",!0),"天"===U.value.timeUnit?((0,t.wg)(),(0,t.j4)(b,{key:2,modelValue:U.value.month,"onUpdate:modelValue":l[3]||(l[3]=e=>U.value.month=e),style:{width:"220px"},placeholder:"请选择时间","collapse-tags":"","collapse-tags-tooltip":"",class:"mr10"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(q,(e=>((0,t.wg)(),(0,t.j4)(d,{key:e.label,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])):(0,t.kq)("",!0)])),_:1}),(0,t.Wm)(V,{title:"定义Y轴",name:"2"},{default:(0,t.w5)((()=>[(0,t._)("div",g,[(0,t.Wm)(b,{modelValue:U.value.yAxis.list,"onUpdate:modelValue":l[4]||(l[4]=e=>U.value.yAxis.list=e),multiple:"","collapse-tags":"",filterable:"","collapse-tags-tooltip":"","max-collapse-tags":10,style:{width:"500px"},placeholder:"请选择Y轴要统计的数据",onChange:H},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(y,(e=>((0,t.wg)(),(0,t.j4)(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])),_:1}),(0,t.Wm)(V,{title:"过滤条件",name:"3"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(U.value.filterCriteria,((e,l)=>((0,t.wg)(),(0,t.iD)("div",{key:l,class:"filterCriteria"},[(0,t.Wm)(b,{modelValue:e.fieldNames,"onUpdate:modelValue":l=>e.fieldNames=l,size:"small",style:{width:"220px"},placeholder:"请选择字段","collapse-tags":"",filterable:"","collapse-tags-tooltip":"",class:"mr10",onChange:e=>{return a=l,U.value.filterCriteria[a].resultType=e.split("-")[2],void(U.value.filterCriteria[a].fieldName=e.split("-")[1]);var a}},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(S,(e=>((0,t.wg)(),(0,t.j4)(d,{key:e.label,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),(0,t.Wm)(b,{modelValue:e.operator,"onUpdate:modelValue":l=>e.operator=l,size:"small",class:"mr10",style:{width:"120px"},placeholder:"请选择过滤类型","collapse-tags":"",filterable:"","collapse-tags-tooltip":""},{default:(0,t.w5)((()=>[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(D,(e=>(0,t.Wm)(d,{key:e.label,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:2},1032,["modelValue","onUpdate:modelValue"]),"STRING"===e.resultType?((0,t.wg)(),(0,t.j4)(b,{key:0,modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,multiple:"",size:"small",filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:"请输入值",style:{width:"240px"}},{default:(0,t.w5)((()=>[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)([],(e=>(0,t.Wm)(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:2},1032,["modelValue","onUpdate:modelValue"])):"DATE"===e.resultType?((0,t.wg)(),(0,t.j4)(A,{key:1,modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,type:"daterange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",size:"small",onChange:l=>{e.value=[Date.parse(l[0]),Date.parse(l[1])]}},null,8,["modelValue","onUpdate:modelValue","onChange"])):(0,t.kq)("",!0),(0,t.Wm)(a,{class:"dialog-close-btn ml10",type:"danger",icon:"CloseBold",size:"small",circle:"",onClick:e=>{var a;a=l,U.value.filterCriteria.splice(a,1)}},null,8,["onClick"])])))),128)),(0,t.Wm)(a,{type:"primary",text:"",onClick:x},{default:(0,t.w5)((()=>[(0,t.Uk)(" + 新增条件 ")])),_:1})])),_:1}),U.value.year?((0,t.wg)(),(0,t.j4)(V,{key:0,title:"添加对比曲线",name:"4"},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{modelValue:U.value.compare.fieldName,"onUpdate:modelValue":l[5]||(l[5]=e=>U.value.compare.fieldName=e),size:"small",style:{width:"220px"},placeholder:"请选择对比字段","collapse-tags":"",filterable:"","collapse-tags-tooltip":"",class:"mr10"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(S,(e=>((0,t.wg)(),(0,t.j4)(d,{key:e.label,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),(0,t.Wm)(K,{disabled:"",style:{width:"220px"},size:"small",value:"等于"}),(0,t._)("div",v,[(0,t.Wm)(b,{modelValue:U.value.compare.list,"onUpdate:modelValue":l[6]||(l[6]=e=>U.value.compare.list=e),multiple:"",size:"small",filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:"请输入值",style:{width:"500px"}},{default:(0,t.w5)((()=>[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)([],(e=>(0,t.Wm)(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])])),_:1})):(0,t.kq)("",!0)])),_:1},8,["modelValue"])])])),key:"0"}:void 0]),1032,["loading","form-data","form-input-el","form-select-el","form-text-area-el","form-upload-el","is-change","onEmitOpenDialog","onInputDone"]),j.isShow?((0,t.wg)(),(0,t.j4)(r.Z,{key:0,ref:"dialogSearch","use-choose":!1,"append-table-style":{background:"#126f9e",color:"#fff",borderColor:"rgba(192, 192, 192,.5)"},width:"60%","search-input-placeholder":j.searchPlaceholde,"is-show":j.isShow,"data-source":j.dataSource,title:"选择数据","is-show-search-input":"",loading:(0,s.SU)(i.V),onCloseDialog:l[8]||(l[8]=e=>j.isShow=!1),onDoDialogSearch:j.doSearch,onChooseRow:j.chooseRow},null,8,["append-table-style","search-input-placeholder","is-show","data-source","loading","onDoDialogSearch","onChooseRow"])):(0,t.kq)("",!0)])),_:1},8,["modelValue"])])}}};var b=(0,a(40089).Z)(l,[["__scopeId","data-v-36a67764"]])}}]);