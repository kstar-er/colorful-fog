"use strict";(self.webpackChunksystem=self.webpackChunksystem||[]).push([[4232,9506],{99506:function(e,t,a){a.r(t),a.d(t,{default:function(){return o}}),a(57658);var i=a(73396),s=a(44870),l=a(67732);const r=["id"],n={key:0,class:"flex-center mt50",style:{color:"#999"}};var o={__name:"line",setup(e,{expose:t}){let a=null,o=(0,s.qj)([]),c=[];const d={title:{text:"",top:5,left:5,textStyle:{fontSize:16,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"cross",crossStyle:{color:"#666"}},textStyle:{fontSize:12}},grid:{top:80,left:100},legend:{align:"left",right:"30px",type:"plain",top:"24px",itemHeight:10,textStyle:{color:"#666",fontSize:11},lineStyle:{width:2},tooltip:{show:!0},itemGap:10,itemWidth:18,data:[]},xAxis:{name:"日期",type:"category",data:["商家1","商家2","商家3","商家4","商家5","商家6","商家7","商家8","商家9"],axisLine:{show:!0,lineStyle:{color:"rgba(171, 51, 79,1)"}},label:{formatter(e){return e.value}}},toolbox:{top:24,left:4,feature:{saveAsImage:{},magicType:{type:["line","bar"]}}},yAxis:{name:"数量(套/件)"},series:[]};return(0,i.bv)((()=>{})),t({initLineOptions:(e,t,s=[],r)=>{var n,m;d.xAxis.name=e.x.name,d.xAxis.data=e.x.data,d.series=e.y,d.title.text=t,d.legend.data=s,({id:n,lineContext:m}={id:r,lineContext:null}),o.push(n),c.push(null),(0,i.Y3)((()=>{m&&a.dispose();var e=document.getElementById(n);e?.removeAttribute("_echarts_instance_"),c[c.length-1]=l.S1(e),c[c.length-1].setOption(d)}))},defaultSeriesOptions:(e,t)=>({name:t,type:"bar",symbol:"circle",showAllSymbol:!0,smooth:!0,data:[],color:"rgba("+e.join(",")+",.5)",symbolSize:6,lineStyle:{width:1.5,color:"rgba("+e.join(",")+")"},markPoint:{data:[{type:"max",name:"Max"},{type:"min",name:"Min"}],symbolSize:30},markLine:{data:[{type:"average",name:"Avg",label:{formatter:e=>"平均 "+Math.round(e.value)}}]},areaStyle:{color:new l.Q.o(0,0,0,1,[{offset:0,color:"rgba("+e.join(",")+",0.1)"},{offset:1,color:"rgba("+e.join(",")+",0)"}],!1),shadowColor:"rgba("+e.join(",")+",1)",shadowBlur:20}}),disposeLine:e=>{var t=o.findIndex((t=>t===e));-1!==t&&(c[t].dispose(),o.splice(t,1),c.splice(t,1))}}),(e,t)=>((0,i.wg)(),(0,i.iD)("div",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)((0,s.SU)(o),(e=>((0,i.wg)(),(0,i.iD)("div",{id:e,key:e,style:{width:"66vw",height:"430px"},class:"pt10"},null,8,r)))),128)),0===(0,s.SU)(o).length?((0,i.wg)(),(0,i.iD)("div",n," 暂 无 数 据 ")):(0,i.kq)("",!0)]))}}},2428:function(e,t,a){a.r(t),a.d(t,{default:function(){return R}}),a(57658);var i=a(73396),s=a(44870),l=a(87139),r=a(52001),n=a(52831),o=a(99506);t=e=>((0,i.dD)("data-v-2b700ecb"),e=e(),(0,i.Cn)(),e);const c={class:"pt10 pl10 pr10",style:{background:"#fff"}},d={class:"chart-container"},m={class:"chart-container-left"},p=t((()=>(0,i._)("div",{class:"input-content-header"},[(0,i._)("span",null,"数据展示")],-1))),u={class:"charts-content"},y={class:"chart-container-right"},h={class:"chart-container-right-header"},f=t((()=>(0,i._)("span",{class:"mr10"},"我的图表",-1))),x={class:"settings-content"},v={class:"pane"},g={class:"card-header"},w={class:"flex-center"},b=["title"],_=["onClick"],k={class:"card-content"},A={class:"content-item"},N=t((()=>(0,i._)("div",{class:"com-span"}," Y 轴： ",-1))),S={style:{flex:"1"}},U={class:"content-item"},O=t((()=>(0,i._)("div",{class:"com-span"}," X 轴： ",-1))),C={style:{flex:"1"}},D={key:0,class:"content-item"},z=t((()=>(0,i._)("div",{class:"com-span"}," 统计时间： ",-1))),j={style:{flex:"1"}},T={class:"content-item"},E=t((()=>(0,i._)("div",{class:"com-span"}," 类型： ",-1))),I={style:{flex:"1"}},J={key:1,class:"content-item mb10"},W=t((()=>(0,i._)("div",{class:"com-span"}," 过滤： ",-1))),$={style:{flex:"1"}},F={key:2,class:"content-item"},P=t((()=>(0,i._)("div",{class:"com-span"}," 对比曲线： ",-1))),H={style:{flex:"1"}},V=t((()=>(0,i._)("br",null,null,-1))),L={class:"options"};t={__name:"index",setup(e){const t=(0,i.FN)()["proxy"],a=(0,s.iH)(null),R=((0,i.wF)((()=>{a.value=new r.o,R()})),()=>{a.value.getRepoJson().then((e=>{200===e.code&&(Z.length=0,Z.push(...JSON.parse(e.data)))}))}),Y=e=>Math.floor(Math.random()*(e+1)),q=()=>[Y(255),Y(255),Y(255)],M=(e,a)=>{var i=["统计数据",...e.x.data];let s=[];e.y.forEach((e=>{s.push([e.name,...e.data])})),(new t.$DataTool).exportExcel(i,s,a,{A1:{font:{bold:!0},alignment:{horizontal:"center"},fill:{fgColor:{rgb:"FFFF00"}}}})},B=(0,s.iH)("first"),K=(0,s.iH)(!1),Q=(0,s.iH)({}),G=()=>{X=-1,Q.value={sourceInterfaceName:"billMain",title:"我的报表",chartsType:["折线图 & 柱状图"],year:null,timeUnit:null,month:null,xAxis:{fieldName:"",resultType:"",value:""},yAxis:{list:[]},filterCriteria:[],compare:{list:[],fieldName:""}},K.value=!0};let X=-1,Z=(0,s.qj)([]);const ee=(e,a,i,{title:s,id:l,type:r})=>{i=Object.entries(i);let n={x:{name:e,data:[]},y:[]},o={},c=[];if(i.forEach(((e,i)=>{n.x.data.push(e[0]),e[1].forEach(((e,i)=>{var s=Object.keys(e)[0];o.hasOwnProperty(s)||(n.y.push({name:a[i].split("-")[0],data:[],...t.$refs.charts.defaultSeriesOptions(q(),a[i].split("-")[0])}),c.push(a[i].split("-")[0]),o[s]=i),n.y[o[s]].data.push(Number(e[s].toFixed(2)))}))})),"export"!==r)return t.$refs.charts.initLineOptions(n,s,c,l),n;M(n,s)},te=(e,a,i,{timeUnit:s,year:l,month:r,title:n,id:o,type:c})=>{var d=Object.keys(i).sort(((e,t)=>-1!==e.indexOf("-")?+e.split("-")[1]-+t.split("-")[1]:+e-+t));let m={x:{name:e,data:[]},y:[]},p={},u=[];if(d.forEach((e=>{"天"===s?m.x.data.push(l+"-"+r+"-"+e):m.x.data.push(l+"-"+e),i[e].forEach(((e,i)=>{var s=Object.keys(e)[0];p.hasOwnProperty(s)||(m.y.push({name:a[i].split("-")[0],data:[],...t.$refs.charts.defaultSeriesOptions(q(),a[i].split("-")[0])}),u.push(a[i].split("-")[0]),p[s]=i),m.y[p[s]].data.push(Number(e[s].toFixed(2)))}))})),"export"!==c)return t.$refs.charts.initLineOptions(m,n,u,o),m;M(m,n)},ae=async(e,i)=>{var s={sourceValue:e.sourceValue,sourceInterfaceName:e.sourceInterfaceName,yaxis:e.yAxis.list.map((e=>e.split("-")[1])),xaxis:e.xAxis.fieldName.split("-")[1],xaxisIsTime:"DATE"===e.xAxis.resultType};e.year&&(s.year=e.year),e.month&&(s.month=e.month),e.timeUnit&&(s.timeUnit=e.timeUnit);let l=[];for(let t=0;t<e.compare.list.length;t++){var r=[{fieldName:e.compare.fieldName.split("-")[1],value:[e.compare.list[t]],operator:"等于"}];s.filterCriteria=r,await a.value.getReportData(s).then((e=>{200===e.code&&l.push(e.data)}))}if(l.length===e.compare.list.length){var n=Object.keys(l[0]).sort(((e,t)=>-1!==e.indexOf("-")?+e.split("-")[1]-+t.split("-")[1]:+e-+t));let a={x:{name:e.xAxis.fieldName.split("-")[0],data:[]},y:[]},s=[],r=(e.compare.list.forEach((i=>{e.yAxis.list.forEach((e=>{e=i+"-"+e.split("-")[0],a.y.push({name:e,data:[],...t.$refs.charts.defaultSeriesOptions(q(),e)}),s.push(e)}))})),Array.from({length:e.compare.list.length*e.yAxis.list.length},((e,t)=>0===t?{isPush:!0}:{isPush:!1})));n.forEach((t=>{"天"===e.timeUnit?a.x.data.push(e.year+"-"+e.month+"-"+t):a.x.data.push(e.year+"-"+t),l.forEach((e=>{e[t].forEach(((e,t)=>{var i=Object.keys(e)[0],s=r.findIndex((e=>e.isPush));a.y[s].data.push(Number(e[i].toFixed(2))),r[s].isPush=!1,r[s+1]?r[s+1].isPush=!0:r[0].isPush=!0}))}))})),"export"===i?M(a,title):t.$refs.charts.initLineOptions(a,e.title,s,e.id)}},ie=e=>{-1!==X?Z.splice(X,1,e):Z.push(e),e=JSON.stringify(Z),a.value.saveReportJson({chartJSON:e}).then((e=>{200===e.code&&(t.$message.success("配置保存成功，请重新绘制数据"),K.value=!1)}))};return(0,i.JJ)("handleChartsData",ee),(0,i.JJ)("handleChartsDataFromDate",te),(e,R)=>{const Y=(0,i.up)("el-button");var q=(0,i.up)("el-tooltip");const M=(0,i.up)("el-tag"),se=(0,i.up)("el-card"),le=(0,i.up)("el-tab-pane");var re=(0,i.up)("el-tabs"),ne=(0,i.Q2)("loading");return(0,i.wg)(),(0,i.iD)("div",c,[(0,i._)("div",d,[(0,i._)("div",m,[p,(0,i.wy)(((0,i.wg)(),(0,i.iD)("div",u,[(0,i.Wm)(o.default,{ref:"charts"},null,512)])),[[ne,(0,s.SU)(r.V)&&!K.value]])]),(0,i._)("div",y,[(0,i._)("div",h,[f,(0,i.Wm)(q,{class:"box-item",content:"添加新图表",placement:"bottom"},{default:(0,i.w5)((()=>[(0,i.Wm)(Y,{icon:"Plus",circle:"",type:"primary",size:"small",onClick:G})])),_:1})]),(0,i.Wm)(re,{modelValue:B.value,"onUpdate:modelValue":R[0]||(R[0]=e=>B.value=e),class:"demo-tabs"},{default:(0,i.w5)((()=>[(0,i.Wm)(le,{label:"我的图表",name:"first"},{default:(0,i.w5)((()=>[(0,i._)("div",x,[(0,i._)("div",v,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)((0,s.SU)(Z),((e,s)=>((0,i.wg)(),(0,i.j4)(se,{key:s,class:"box-card mb20"},{header:(0,i.w5)((()=>[(0,i._)("div",g,[(0,i._)("div",w,[(0,i._)("span",{class:"com-span",title:e.title},(0,l.zw)(e.title),9,b),(0,i._)("span",{class:"tag",title:"绘制图表",onClick:i=>{return s=e,t.$refs.charts.disposeLine(s.id),void(0!==s.compare.list.length?ae(s):(l={sourceValue:s.sourceValue,sourceInterfaceName:s.sourceInterfaceName,yaxis:s.yAxis.list.map((e=>e.split("-")[1])),xaxis:s.xAxis.fieldName.split("-")[1],filterCriteria:s.filterCriteria,xaxisIsTime:"DATE"===s.xAxis.resultType},s.year&&(l.year=s.year),s.month&&(l.month=s.month),s.timeUnit&&(l.timeUnit=s.timeUnit),a.value.getReportData(l).then((e=>{200===e.code&&(0===Object.keys(e.data).length?t.$message.error("获取数据失败，请检查配置或源数据"):"DATE"===s.xAxis.resultType?te(s.xAxis.fieldName.split("-")[0],s.yAxis.list,e.data,{timeUnit:s.timeUnit,year:s.year,month:s.month,title:s.title,id:s.id}):ee(s.xAxis.fieldName.split("-")[0],s.yAxis.list,e.data,{title:s.title,id:s.id}))}))));var s,l}},(0,l.zw)("绘制图表"),8,_)]),(0,i._)("div",null,[(0,i.Wm)(Y,{size:"small",type:"danger",class:"ml10",onClick:e=>{var i;i=s,t.$alert("是否确认删除此报表配置，删除后无法恢复","提示",{type:"info",icon:"InfoFilled",showCancelButton:!0,cancelButtonText:"再想想",confirmButtonText:"确定",callback:e=>{"confirm"===e&&(Z.splice(i,1),e=JSON.stringify(Z),a.value.saveReportJson({chartJSON:e}).then((e=>{200===e.code&&(t.$message.success("删除成功"),K.value=!1)})))}})}},{default:(0,i.w5)((()=>[(0,i.Uk)(" 删除该配置 ")])),_:2},1032,["onClick"])])])])),default:(0,i.w5)((()=>[(0,i._)("div",k,[(0,i._)("div",A,[N,(0,i._)("div",S,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.yAxis.list,(e=>((0,i.wg)(),(0,i.j4)(M,{key:e,class:"mr10 mb10","disable-transitions":!1,style:{cursor:"pointer"},size:"small",type:"success"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(e.split("-")[0]),1)])),_:2},1024)))),128))])]),(0,i._)("div",U,[O,(0,i._)("div",C,[(0,i.Wm)(M,{"disable-transitions":!1,style:{cursor:"pointer"},size:"small",type:"info",class:"mr10"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(e.xAxis.fieldName.split("-")[0]),1)])),_:2},1024)])]),e.year?((0,i.wg)(),(0,i.iD)("div",D,[z,(0,i._)("div",j,[(0,i.Wm)(M,{class:"mr10","disable-transitions":!1,style:{cursor:"pointer"},size:"small",type:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(e.year+"-"+e.month),1)])),_:2},1024)])])):(0,i.kq)("",!0),(0,i._)("div",T,[E,(0,i._)("div",I,[(0,i.Wm)(M,{"disable-transitions":!1,style:{cursor:"pointer"},size:"small",type:"warning",class:"mr10"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(e.chartsType.join("-")),1)])),_:2},1024)])]),0!==e.filterCriteria.length?((0,i.wg)(),(0,i.iD)("div",J,[W,(0,i._)("div",$,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.filterCriteria,(e=>((0,i.wg)(),(0,i.j4)(M,{key:e,class:"mr10","disable-transitions":!1,style:{cursor:"pointer"},size:"small",type:"danger"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(e.fieldNames.split("-")[0]+"..."),1)])),_:2},1024)))),128))])])):(0,i.kq)("",!0),0!==e.compare.list.length?((0,i.wg)(),(0,i.iD)("div",F,[P,(0,i._)("div",H,[(0,i.Wm)(M,{size:"small",class:"mr10 mb10"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(e.compare.fieldName.split("-")[0]+"等于"),1)])),_:2},1024),V,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.compare.list,(e=>((0,i.wg)(),(0,i.j4)(M,{key:e,class:"mr10 mb10","disable-transitions":!1,style:{cursor:"pointer"},size:"small",type:"danger"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(e),1)])),_:2},1024)))),128))])])):(0,i.kq)("",!0)]),(0,i._)("div",L,[(0,i.Wm)(Y,{size:"small",type:"success",onClick:i=>{var s,l;0!==(s=e).compare.list.length?ae(s,"export"):(l={sourceValue:s.sourceValue,sourceInterfaceName:s.sourceInterfaceName,yaxis:s.yAxis.list.map((e=>e.split("-")[1])),xaxis:s.xAxis.fieldName.split("-")[1],filterCriteria:s.filterCriteria,xaxisIsTime:"DATE"===s.xAxis.resultType},s.year&&(l.year=s.year),s.month&&(l.month=s.month),s.timeUnit&&(l.timeUnit=s.timeUnit),a.value.getReportData(l).then((e=>{200===e.code&&(0===Object.keys(e.data).length?t.$message.error("获取数据失败，请检查配置或源数据"):"DATE"===s.xAxis.resultType?te(s.xAxis.fieldName.split("-")[0],s.yAxis.list,e.data,{timeUnit:s.timeUnit,year:s.year,month:s.month,title:s.title,id:s.id,type:"export"}):ee(s.xAxis.fieldName.split("-")[0],s.yAxis.list,e.data,{title:s.title,id:s.id,type:"export"}))})))}},{default:(0,i.w5)((()=>[(0,i.Uk)(" 导出excel ")])),_:2},1032,["onClick"]),(0,i.Wm)(Y,{size:"small",type:"primary",onClick:t=>{return a=e,i=s,X=i,Q.value={...JSON.parse(JSON.stringify(a))},void(K.value=!0);var a,i}},{default:(0,i.w5)((()=>[(0,i.Uk)(" 修改配置 ")])),_:2},1032,["onClick"])])])),_:2},1024)))),128))])])])),_:1})])),_:1},8,["modelValue"])])]),(0,i.Wm)(n.default,{"is-show":K.value,default:Q.value,onCloseDialog:R[1]||(R[1]=e=>K.value=!1),onSaveReportJSON:ie},null,8,["is-show","default"])])}}};var R=(0,a(40089).Z)(t,[["__scopeId","data-v-2b700ecb"]])}}]);