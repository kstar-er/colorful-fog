"use strict";(self.webpackChunksystem=self.webpackChunksystem||[]).push([[3207,9278,9301],{29288:function(e,a,l){l.d(a,{B6:function(){return h},Nm:function(){return c},V_:function(){return t.V},WJ:function(){return u},Xw:function(){return d},Z$:function(){return f},aX:function(){return p},bz:function(){return g},dn:function(){return n},fm:function(){return y},g9:function(){return s},gV:function(){return m},kN:function(){return b},o2:function(){return r},u0:function(){return i},v8:function(){return v}}),l(57658);var t=l(81081),o=(a=l(20566),l(68521));class r extends a.Z{constructor({modules:e="",selectUri:a="/",deleteUri:l="/",selectOneUri:t="/",pageSize:o=20,tableHeader:r}={}){super({modules:e,selectUri:a,deleteUri:l,selectOneUri:t,pageSize:o,tableHeader:r})}forMatData(e,a){return"executionUnit"!==e?"executionTime"!==e&&e&&a&&(-1!==e.indexOf("Time")||-1!==e.indexOf("Date"))?(new o.x).timeStamp2Time(a,"yyyy-MM-dd hh:mm:ss"):a&&0<a.toString().length||"number"==typeof a?a:"-":{DAILY:"每日生成一次",MONTHLY:"每月生成一次"}[a]}createTreeData(e){let a=[];return Object.keys(e).forEach((l=>{a.push({name:l,children:e[l]})})),a}async initData(e=this,a){e.tableData.length=0;var{data:l,code:o}=(await t.K.post(`${e.selectUri}?currentPage=${e.currentPage}&pageSize=`+e.pageSize,e.searchData))["data"];200===o&&(e.tableData=e.createTreeData(l),e.total=e.tableData.length)}currentPageChange(e,a=this,l){a.currentPage=e,a.initData(a,l)}pageSizeChange(e,a=this,l){a.currentPage=1,a.pageSize=e,a.initData(a,l)}search(e,a=this,l){a.searchData=e,a.currentPage=1,a.initData(a,l,!0)}async getSolutionList(){var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/schemeMain/getGroupType"))["data"];return 200===e?{code:e,data:a}:l}async getDetail(e){var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/schemeMain/selectOneById?id="+e))["data"];return 200===e?{data:a,code:e}:l}async deleteSchemeMain(e){var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/schemeMain/deleteSchemeMain",e))["data"];return 200===e?{data:a,code:e}:l}async refreshBill(e){var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/schemeMain/flash",e))["data"];return 200===e?{data:a,code:e}:l}async createBill(e){var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/schemeMain/create",e))["data"];return 200===e?{data:a,code:e}:l}async getBelongTable(e){var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/schemeUser/geBelongTable",e))["data"];return 200===e?{data:a,code:e}:l}async getUserAndScheme(e){var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/schemeUser/getUserAndScheme",e))["data"];return 200===e?{data:a,code:e}:l}async addSchemeToUser(e){var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/schemeUser/add",e))["data"];return 200===e?{data:a,code:e}:l}}const i=async e=>{var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/schemeDetail/updateSchemeDetailBatch",e))["data"];return 200===e?{data:a,code:e}:l},d=async e=>{var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/schemeDetail/updateDisplay",e))["data"];return 200===e?{data:a,code:e}:l},s=async e=>{var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/schemeDetail/addSchemeDetailBatch",e))["data"];return 200===e?{data:a,code:e}:l},n=async e=>{var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/schemeDetail/deleteSchemeDetail",e))["data"];return 200===e?{data:a,code:e}:l},u=async e=>{var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/schemeMain/updateSchemeMain",e))["data"];return 200===e?{data:a,code:e}:l},c=async e=>{var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/schemeMain/selectOneById?id="+e))["data"];return 200===e?{data:a,code:e}:l},m=async e=>{var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/schemeMain/addSchemeMain",e))["data"];return 200===e?{data:a,code:e}:l},p=async e=>{var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/condition/add",e))["data"];return 200===e?{data:a,code:e}:l},h=async e=>{var{data:e,code:a,message:l}=(await t.K.post("/colorful-fog/condition/delete",e))["data"];return 200===a?{data:e,code:a}:l},f=async e=>{var{data:e,code:a,message:l}=(await t.K.post("/colorful-fog/schemeUser/bindUserBatch",e))["data"];return 200===a?{data:e,code:a}:l},v=async e=>{var{data:e,code:a,message:l}=(await t.K.post("/colorful-fog/schemeUser/addOrUpdateBatch",e))["data"];return 200===a?{data:e,code:a}:l},g=async e=>{var{data:e,code:a,message:l}=(await t.K.post("/colorful-fog/schemeUser/delete",e))["data"];return 200===a?{data:e,code:a}:l},y=async e=>{var{data:e,code:a,message:l}=(await t.K.post("/colorful-fog/schemeMain/testScheme",e))["data"];return 200===a?{data:e,code:a}:l},b=async e=>{var{data:e,code:a,message:l}=(await t.K.post("/colorful-fog/schemeDetail/copyField",e))["data"];return 200===a?{data:e,code:a}:l}},82134:function(e,a,l){l.d(a,{V:function(){return t.V},o:function(){return r}}),l(57658);var t=l(81081),o=(a=l(20566),l(68521));class r extends a.Z{constructor({modules:e="",selectUri:a="/",deleteUri:l="/",selectOneUri:t="/",pageSize:o=20,tableHeader:r}={}){super({modules:e,selectUri:a,deleteUri:l,selectOneUri:t,pageSize:o,tableHeader:r})}async initData(e=this,a){var{data:l,code:o}=(await t.K.post(`${e.selectUri}?currentPage=${e.currentPage}&pageSize=`+e.pageSize,e.searchData))["data"];200===o&&(e.total=l.pageInfo.total,e.tableData.length=0,e.tableData.push(...l.pageInfo.list),a?.clearSelection())}currentPageChange(e,a=this,l){a.currentPage=e,a.initData(a,l)}pageSizeChange(e,a=this,l){a.currentPage=1,a.pageSize=e,a.initData(a,l)}search(e,a=this,l){a.searchData=e,a.currentPage=1,a.initData(a,l,!0)}forMatData(e,a){return"dependType"!==e?e&&a&&(-1!==e.indexOf("Time")||-1!==e.indexOf("Date"))?(new o.x).timeStamp2Time(a,"yyyy-MM-dd hh:mm:ss"):a&&0<a.toString().length||"number"==typeof a?a:"-":{SORT:"名词分类",RANGE:"范围分类",DEPEND:"二次分类",OTHER:"其他"}[a]}async addDependMain(e){var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/dependMain/addDependMain",e))["data"];return 200===e?{data:a,code:e}:l}async updateDependMain(e){var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/dependMain/updateDependMain",e))["data"];return 200===e?{data:a,code:e}:l}async deleteDependMain(e){var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/dependMain/deleteDependMain",e))["data"];return 200===e?{data:a,code:e}:l}async addDependRule(e){var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/dependRule/addDependRule",e))["data"];return 200===e?{data:a,code:e}:l}async updateDependRule(e){var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/dependRule/updateDependRule",e))["data"];return 200===e?{data:a,code:e}:l}async deleteDependRule(e){var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/dependRule/deleteDependRule",e))["data"];return 200===e?{data:a,code:e}:l}async addDependDataBatch(e){var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/dependData/addDependDataBatch",e))["data"];return 200===e?{data:a,code:e}:l}async updateDependData(e){var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/dependData/updateDependData",e))["data"];return 200===e?{data:a,code:e}:l}async deleteDependData(e){var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/dependData/deleteDependData",e))["data"];return 200===e?{data:a,code:e}:l}async deleteDependData(e){var{code:e,data:a,msg:l}=(await t.K.post("/colorful-fog/dependData/deleteDependData",e))["data"];return 200===e?{data:a,code:e}:l}}},81198:function(e,a,l){l.d(a,{B:function(){return o}});var t=l(73396);function o(){const e=(0,t.FN)()["proxy"];return{popup:{handleAlert:(a,l,t,o)=>{t={type:"info",showCancelButton:!0,cancelButtonText:"再想想",confirmButtonText:"确认",callback:e=>{"confirm"===e&&o()},...t},e.$alert(l,a,t)},handlePrompt:(a,l,t,o)=>{t={confirmButtonText:"确定",cancelButtonText:"取消",...t},e.$prompt(l,a,t).then((({value:e})=>{o(e)})).catch((()=>{}))}}}}},22142:function(e,a,l){l.r(a),l.d(a,{default:function(){return n}});var t=l(73396),o=l(87139),r=l(92692);const i={key:0},d={class:"jx-dialog-header"},s=["id"];a={__name:"createCondition",props:{isShow:{type:Boolean,default:!1},conditionItem:{type:Object,default:()=>({})}},emits:["closeDialog","inputDone","emitOpenDialog"],setup(e,{emit:a}){const l=e;var{}=(0,t.FN)();const n=()=>{a("closeDialog")},u=(0,t.Fl)({get(){return l.isShow},set(){}});return(a,l)=>{const c=(0,t.up)("el-button");var m=(0,t.up)("el-dialog");return e.isShow?((0,t.wg)(),(0,t.iD)("div",i,[(0,t.Wm)(m,{modelValue:u.value,"onUpdate:modelValue":l[0]||(l[0]=e=>u.value=e),top:"4%",width:"80%","close-on-click-modal":!1,"show-close":!1,"lock-scroll":""},{header:(0,t.w5)((({titleId:e,titleClass:l})=>[(0,t._)("div",d,[(0,t._)("h4",{id:e,class:(0,o.C_)(l)},[(0,t.Uk)(" 构造计算表达式 "),(0,t.WI)(a.$slots,"customOperation")],10,s),(0,t.Wm)(c,{class:"dialog-close-btn",type:"danger",icon:"CloseBold",circle:"",plain:"",onClick:n})])])),default:(0,t.w5)((()=>[(0,t._)("div",null,[((0,t.wg)(),(0,t.j4)((0,t.LL)(r.default),{"is-component":!0,"condition-item":e.conditionItem},null,8,["condition-item"]))])])),_:3},8,["modelValue"])])):(0,t.kq)("",!0)}}};var n=(0,l(40089).Z)(a,[["__scopeId","data-v-f4ca1f84"]])},79278:function(e,a,l){l.r(a),l.d(a,{default:function(){return y}}),l(57658);var t=l(73396),o=l(87139),r=l(44870);a=e=>((0,t.dD)("data-v-ccf07282"),e=e(),(0,t.Cn)(),e);const i={key:0},d={class:"jx-dialog-header"},s=["id"],n=a((()=>(0,t._)("div",null," 字段名称： ",-1))),u=["onClick"],c={class:"mt10"},m=a((()=>(0,t._)("div",null," 运算规则： ",-1))),p={class:"mt10"},h=a((()=>(0,t._)("div",null," 表达式： ",-1))),f={ref:"expression",class:"expression"},v={key:0,class:"mt10"},g={class:"mt10"};a={__name:"createFun",props:{isShow:{type:Boolean,default:!1},confirmText:{type:String,default:"确定"},list:{type:Object,default:()=>[]},defaultExpresion:{type:String,default:""}},emits:["closeDialog","inputDone","emitOpenDialog"],setup(e,{emit:a}){const l=e;var{}=(0,t.FN)();(0,t.YP)((()=>l.isShow),(()=>{if(l.isShow){w.length=0;var e=l.defaultExpresion;let t=0,o="";var a=[];for(let l=0;l<e.length;)"$"===e[l]?(t=1,l+=2):t&&"}"===e[l]?(a.push(o),o="",e[l+1]&&a.push(e[l+1]),l+=2,t=0):(t?o+=e[l]:a.push(e[l]),l++);a.forEach((e=>{var a;-1==="()+-*/".indexOf(e)?(a=l.list.find((a=>(a?.resultCode??a?.collectResultCode)===e)),w.push({name:a?.resultName??a?.collectResultName,code:a?.resultCode??a?.collectResultCode})):w.push({name:e,type:"danger"})}))}}));const y=()=>{a("closeDialog")},b=()=>{let e="";w.forEach((a=>{a.type?e+=a.name:e+=`\${${a.code}}`})),a("inputDone",e)},w=(0,r.qj)([]),D=(e,a)=>{"danger"===a?w.push({name:e,type:a}):w.push({name:e?.resultName??e?.collectResultName,code:e?.resultCode??e?.collectResultCode})},S=(0,t.Fl)({get(){return l.isShow},set(){}});return(a,l)=>{const r=(0,t.up)("el-button"),T=(0,t.up)("el-tag"),_=(0,t.up)("xButton");var N=(0,t.up)("el-dialog");return e.isShow?((0,t.wg)(),(0,t.iD)("div",i,[(0,t.Wm)(N,{modelValue:S.value,"onUpdate:modelValue":l[6]||(l[6]=e=>S.value=e),top:"4%","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,"lock-scroll":""},{header:(0,t.w5)((({titleId:e,titleClass:l})=>[(0,t._)("div",d,[(0,t._)("h4",{id:e,class:(0,o.C_)(l)},[(0,t.Uk)(" 构造计算表达式 "),(0,t.WI)(a.$slots,"customOperation")],10,s),(0,t.Wm)(r,{class:"dialog-close-btn",type:"danger",icon:"CloseBold",circle:"",plain:"",onClick:y})])])),default:(0,t.w5)((()=>[(0,t._)("div",null,[(0,t._)("div",null,[n,((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.list,(e=>((0,t.wg)(),(0,t.iD)("div",{key:e.id,ref_for:!0,ref:"tag"+e.id,class:"mr20 mt10 tag",style:{cursor:"pointer"},onClick:a=>D(e)},(0,o.zw)(e?.resultName??e?.collectResultName),9,u)))),128))]),(0,t._)("div",c,[m,(0,t._)("div",{ref:"add",class:"mr20 mt10 tag",type:"danger","disable-transitions":!1,style:{cursor:"pointer",background:"rgb(252, 156, 172)"},onClick:l[0]||(l[0]=e=>D("(","danger"))}," ( ",512),(0,t._)("div",{ref:"add",class:"mr20 mt10 tag",type:"danger","disable-transitions":!1,style:{cursor:"pointer",background:"rgb(252, 156, 172)"},onClick:l[1]||(l[1]=e=>D(")","danger"))}," ) ",512),(0,t._)("div",{ref:"add",class:"mr20 mt10 tag",type:"danger","disable-transitions":!1,style:{cursor:"pointer",background:"rgb(252, 156, 172)"},onClick:l[2]||(l[2]=e=>D("+","danger"))}," + ",512),(0,t._)("div",{ref:"subtract",class:"mr20 mt10 tag",type:"danger","disable-transitions":!1,style:{cursor:"pointer",background:"rgb(252, 156, 172)"},onClick:l[3]||(l[3]=e=>D("-","danger"))}," - ",512),(0,t._)("div",{ref:"multiply",class:"mr20 mt10 tag",type:"danger","disable-transitions":!1,style:{cursor:"pointer",background:"rgb(252, 156, 172)"},onClick:l[4]||(l[4]=e=>D("*","danger"))}," * ",512),(0,t._)("div",{ref:"divide",class:"mr20 mt10 tag",type:"danger","disable-transitions":!1,style:{cursor:"pointer",background:"rgb(252, 156, 172)"},onClick:l[5]||(l[5]=e=>D("/","danger"))}," / ",512)]),(0,t._)("div",p,[h,(0,t._)("div",f,[0===w.length?((0,t.wg)(),(0,t.iD)("div",v," 暂无公式 ")):(0,t.kq)("",!0),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(w,((e,a)=>((0,t.wg)(),(0,t.j4)(T,{key:e.name,class:"mr6 mt10",closable:"",type:e.type||"primary",style:{cursor:"pointer"},onClose:e=>{var l;l=a,w.splice(l,1)}},{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(e.name),1)])),_:2},1032,["type","onClose"])))),128))],512)])]),(0,t._)("div",g,[(0,t.Wm)(_,{type:"primary",style:{float:"right","margin-right":"10px"},onClick:b},{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(e.confirmText),1)])),_:1}),(0,t.Wm)(_,{type:"danger",style:{float:"right","margin-right":"10px"},onClick:y},{default:(0,t.w5)((()=>[(0,t.Uk)(" 取消 ")])),_:1})])])),_:3},8,["modelValue"])])):(0,t.kq)("",!0)}}};var y=(0,l(40089).Z)(a,[["__scopeId","data-v-ccf07282"]])},19301:function(e,a,l){l.r(a),l.d(a,{default:function(){return n}}),l(57658);var t=l(73396),o=l(44870);a=e=>((0,t.dD)("data-v-5abaa53f"),e=e(),(0,t.Cn)(),e);const r={class:"mt10 mb20",style:{width:"80vw",margin:"0 auto"}},i=a((()=>(0,t._)("div",{class:"title"}," 单据原数据 ",-1))),d={style:{width:"80vw",margin:"20px auto"}},s=a((()=>(0,t._)("div",{class:"title"}," 生成的账单数据 ",-1)));a={__name:"test",props:{testData:{type:Object,default:()=>({})}},setup(e){const a=e,l=(0,t.FN)()["proxy"],n=(0,o.qj)([]),u=(0,o.qj)([]),c=(0,o.qj)([]),m=(0,o.qj)([]),p=((0,t.YP)((()=>a.testData.resultNameList.length),(()=>{n.length=0,u.length=0,c.length=0,m.length=0,n.push(...a.testData.originNameList.filter((e=>e.resultName&&-1===e.resultName.indexOf("外键")))),c.push(...a.testData.resultNameList.filter((e=>e.resultName))),u.push(...a.testData.originDataList.map((e=>e.keyMap))),m.push(...a.testData.resultDataList.map((e=>e.data)))})),(e,a)=>e[a.property]&&"NULL"!==e[a.property]&&"0"!==e[a.property]?-1!==a.label.indexOf("时间")||-1!==a.label.indexOf("日期")?(new l.$DataTool).timeStamp2Time(+e[a.property],"yyyy-MM-dd hh:mm:ss"):e[a.property]??"-":"-");return(e,a)=>{const l=(0,t.up)("el-table-column");var o=(0,t.up)("el-table");return(0,t.wg)(),(0,t.iD)("div",null,[(0,t._)("div",r,[i,(0,t.Wm)(o,{data:u,height:"400"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n,((e,a)=>((0,t.wg)(),(0,t.j4)(l,{key:a,width:200,prop:e.resultCode,label:e.resultName,formatter:p},null,8,["prop","label"])))),128))])),_:1},8,["data"])]),(0,t._)("div",d,[s,(0,t.Wm)(o,{data:m,height:"400"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(c,((e,a)=>((0,t.wg)(),(0,t.j4)(l,{key:a,prop:e.resultCode,label:e.resultName,formatter:p,width:"200"},null,8,["prop","label"])))),128))])),_:1},8,["data"])])])}}};var n=(0,l(40089).Z)(a,[["__scopeId","data-v-5abaa53f"]])},78449:function(e,a,l){l.r(a),l.d(a,{default:function(){return be}}),l(57658);var t=l(73396),o=l(87139),r=l(44870),i=l(49242),d=l(81081),s=l(79278),n=l(19301),u=l(22142),c=l(98249),m=l(44385),p=l(88490),h=l(81198),f=l(82134),v=l(29288);a=e=>((0,t.dD)("data-v-e68377c8"),e=e(),(0,t.Cn)(),e);const g={class:"content"},y={class:"mt10 mb20"},b=a((()=>(0,t._)("div",null,null,-1))),w={class:"flex-center"},D=a((()=>(0,t._)("span",{style:{"font-size":"16px"}},"计划名称：",-1))),S=a((()=>(0,t._)("span",{class:"text-sm mr10",style:{color:"var(--el-text-color-regular)"}},null,-1))),T={class:"content-body"},_={class:"card-header"},N=a((()=>(0,t._)("span",null,"基本信息",-1))),k={style:{display:"flex","flex-direction":"column"}},M=a((()=>(0,t._)("span",{class:"label-base"},[(0,t._)("span",{style:{color:"red"}},"*"),(0,t.Uk)(" 账单类型： ")],-1))),x={style:{display:"flex","flex-wrap":"wrap"},class:"mt10"},C={class:"mr10 mt10"},U=a((()=>(0,t._)("span",{class:"label-base"},[(0,t._)("span",{style:{color:"red"}},"*"),(0,t.Uk)(" 关联数据库： ")],-1))),F={class:"mr10 mt10"},E=a((()=>(0,t._)("span",null,[(0,t._)("span",{style:{color:"red"}},"*"),(0,t.Uk)(" 账单粒度： ")],-1))),W={class:"mr10 mt10"},I=a((()=>(0,t._)("span",null,[(0,t._)("span",{style:{color:"red"}},"*"),(0,t.Uk)(" 账单归属人绑定字段： ")],-1))),R={style:{display:"flex","flex-wrap":"wrap","align-items":"center"},class:"mt20"},O=a((()=>(0,t._)("span",{class:"label-base"},[(0,t._)("span",{style:{color:"red"}},"*"),(0,t.Uk)(" 账单时间限制表： ")],-1))),V=a((()=>(0,t._)("span",{class:"label-base ml10"},[(0,t._)("span",{style:{color:"red"}},"*"),(0,t.Uk)(" 账单时间限制字段： ")],-1))),A={style:{display:"flex","flex-wrap":"wrap","align-items":"center"},class:"mt20"},L=a((()=>(0,t._)("span",{class:"label-base"},[(0,t._)("span",{style:{color:"red"}},"*"),(0,t.Uk)(" 账单生成计划： ")],-1))),B={class:"ml20",style:{"margin-right":"46px"}},$=a((()=>(0,t._)("span",{class:"ml6"}," 生成一次 ",-1))),H={style:{display:"flex","align-items":"center",width:"500px"},class:"mt20"},z=a((()=>(0,t._)("span",{class:"label-base mr20"},[(0,t._)("span",{style:{color:"red"}},"*"),(0,t.Uk)(" 账单生成限制： ")],-1))),P={class:"card-header"},K=a((()=>(0,t._)("span",null,"关联用户",-1))),j={style:{display:"flex"}},Y={class:"mr10 mt10"},q=a((()=>(0,t._)("span",null,[(0,t._)("span",{style:{color:"red"}},"*"),(0,t.Uk)(" 绑定用户所属表： ")],-1))),G={class:"mr10 mt10"},X=a((()=>(0,t._)("span",null,[(0,t._)("span",{style:{color:"red"}},"*"),(0,t.Uk)(" 绑定的字段： ")],-1))),Z={class:"mr10 mt10"},Q=a((()=>(0,t._)("span",null,[(0,t._)("span",{style:{color:"red"}},"*"),(0,t.Uk)(" 绑定的名称： ")],-1))),J={key:0,class:"mt10"},ee={key:0,class:"flex-center mt20"},ae={class:"card-header"},le=a((()=>(0,t._)("span",null,"账单过滤条件",-1))),te={class:"card-header"},oe=a((()=>(0,t._)("span",null,"账单数据定义",-1))),re=a((()=>(0,t._)("div",{style:{display:"inline-flex","align-items":"center","font-size":"12px"},class:"ml10"},[(0,t._)("div",{class:"common exp"}," 正常 "),(0,t._)("div",{class:"hideWhenPush exp"}," 推送时隐藏 "),(0,t._)("div",{class:"hideWhenExport exp"}," 导出时隐藏 "),(0,t._)("div",{class:"complex exp"}," 推送和导出都隐藏 ")],-1))),ie={class:"collect"},de=["onClick"],se=a((()=>(0,t._)("span",null,"测试方案",-1))),ne={class:"inline-block ml10",style:{"font-weight":"500","font-size":"14px"}},ue=a((()=>(0,t._)("span",{style:{color:"red"}}," 请选择系数类型：",-1))),ce={key:0,style:{color:"red"},class:"ml10"},me={key:0},pe={key:1},he={class:"flex-center",style:{"align-items":"flex-start","flex-wrap":"wrap"}},fe={style:{"max-width":"200px"},class:"mr10"},ve={style:{"max-width":"100px"}},ge=a((()=>(0,t._)("div",{style:{"max-width":"100px"}}," ，取 ",-1))),ye=a((()=>(0,t._)("div",{style:{"max-width":"100px"}}," 否则，取 ",-1)));a={__name:"programme",props:{editId:{type:Number,default:0},addType:{type:String,default:""}},emits:["back"],setup(e,{emit:a}){const l=e,be=(0,t.FN)()["proxy"],we=(0,h.B)()["popup"],De=(0,r.iH)(!1),Se=(0,r.iH)([]),Te=(0,r.qj)([]),_e=(0,r.iH)(!1),Ne=(0,r.iH)(!1),ke=e=>{Ne.value=!1,Se.value=e?Te.map((e=>e.value)):[]},Me=[{label:"每日生成一次",value:"DAILY"},{label:"每月生成一次",value:"MONTHLY"}],xe=(0,r.iH)({conditionList:[],schemeDetailList:[],schemeMain:{name:""},schemeUserRelations:[]}),Ce=(0,r.iH)(-1),Ue=()=>{-1!==Ce.value&&(0,v.Nm)(Ce.value).then((e=>{200===e.code&&(xe.value=e.data,xe.value.schemeMain.timeFormula=[Je(xe.value.schemeMain.timeFormulaStart,xe.value.schemeMain.executionUnit),Je(xe.value.schemeMain.timeFormulaEnd,xe.value.schemeMain.executionUnit)],da(xe.value.schemeMain.executionUnit),Se.value=xe.value.schemeUserRelations.map((e=>e.archiveUserName+" "+e.archiveUserCode)),na(sa),0===Te.length)&&qe("archiveUserName")}))},Fe=(0,r.iH)(!1),Ee=(0,r.iH)([]),We=e=>{const{newIndex:a,oldIndex:l}=e;if(a!==l){l<a&&([a,l]=[l,a]);for(let e=a;e<=l;e++)xe.value.schemeDetailList[e].displayOrder=e+1;Ee.value=[...xe.value.schemeDetailList],Ee.value=Ee.value.slice(a,l+1)}},Ie=()=>{we.handleAlert("提示","是否保存当前的展示顺序",{},(()=>{(0,v.Xw)(Ee.value).then((e=>{200===e.code&&(be.$message.success("保存成功！"),Ue(),Fe.value=!1)}))}))},Re=()=>{we.handleAlert("提示","是否取消修改",{},(()=>{Ue(),Fe.value=!1}))},Oe=((0,t.YP)((()=>l.editId),(()=>{Ce.value=(0,r.IU)(l.editId),Ue()}),{immediate:!0}),(0,r.iH)(!1)),Ve=(0,r.iH)({}),Ae=(0,r.iH)(!1),Le=(0,r.iH)(!1),Be=()=>{Ue(),Le.value=!1},$e=()=>{Oe.value=!0,setTimeout((()=>{a("back"),Oe.value=!1}),800)},He=[{label:"单据字段值",value:"ORDER_DATA"},{label:"固定系数",value:"FIXED"},{label:"分类系数",value:"DEPEND"},{label:"自定义公式",value:"EQUATION"},{label:"多行匹配",value:"FOR_MUL_TAG"},{label:"计算",value:"calc",children:[{label:"汇总",value:"SUM"},{label:"计数",value:"COUNT"},{label:"最大值",value:"MAX"},{label:"最小值",value:"MIN"}]},{label:"正则表达式",value:"REGEX"}],ze=[{label:"当前方案字段",value:"SCHEME"},{label:"源数据表",value:"TABLE"}],Pe=e=>{switch(e=e[e.length-1],be.$refs?.dialogForm?.clearInput(),Ve.value={hideWhenPush:!1,hideWhenExport:!1,tgetDataFrom:"SCHEME",resultType:"STRING",type:e,displayOrder:xe.value.schemeDetailList.length+1,calculateOrder:xe.value.schemeDetailList.length+1},e){case"REGEX":return Xe.formInputEl=[{title:"字段名称",key:"resultName",element:"input"},{title:"绑定数据表",key:"orderName",element:"input",type:"dialog"},{title:"绑定数据表字段",key:"orderField",element:"input",type:"dialog"}],Xe.formTimeAndNumber=[{title:"显示顺序",key:"displayOrder",element:"number"}],Xe.formTextAreaEl=[{title:"正则表达式",key:"expression",element:"input",type:"textarea"}],void Ke("SCHEME");case"FOR_MUL_TAG":case"SINGLE_TAG":return Ve.value.singleType="anyMatch",Ve.value.oneRowTag=!1,Xe.formInputEl=[{title:"字段名称",key:"resultName",element:"input"},{title:"绑定数据表",key:"orderName",element:"input",type:"dialog"},{title:"分组字段",key:"orderField",element:"input",type:"dialog"},{title:"取值字段",key:"groupByFieldName",element:"input",type:"dialog"},{title:"单行标记",key:"oneRowTag",element:"radio",options:[{label:"是",value:!0},{label:"否",value:!1}],illustrate:"勾选之后，同一分组的数据计算出来的结果只会放到该组中的其中一行，其他行设为0",change:e=>{e?Xe.formInputEl[5]||Xe.formInputEl.push({title:"其他行数值",key:"otherRowValue",element:"input"}):Xe.formInputEl[5]&&Xe.formInputEl.splice(5,1)}}],Xe.formTimeAndNumber=[{title:"显示顺序",key:"displayOrder",element:"number"}],Xe.formTextAreaEl=[],void Ke("SCHEME");case"MAX":case"MIN":case"COUNT":case"SUM":return Ve.value.oneRowTag=!1,Xe.formInputEl=[{title:"字段名称",key:"resultName",element:"input"},{title:"绑定数据表",key:"orderName",element:"input",type:"dialog"},{title:"绑定数据表字段",key:"orderField",element:"input",type:"dialog"},{title:"汇总字段所在表",key:"groupByTable",element:"input",type:"dialog"},{title:"汇总字段",key:"groupByFieldName",element:"input",type:"dialog"},{title:"单行标记",key:"oneRowTag",element:"radio",options:[{label:"是",value:!0},{label:"否",value:!1}]}],Xe.formTimeAndNumber=[{title:"显示顺序",key:"displayOrder",element:"number"}],Xe.formTextAreaEl=[],void Ke("SCHEME");case"ORDER_DATA":return Xe.formInputEl=[{title:"字段名称",key:"resultName",element:"input"},{title:"绑定数据表",key:"orderName",element:"input",type:"dialog"},{title:"绑定数据表字段",key:"orderField",element:"input",type:"dialog"}],Xe.formTimeAndNumber=[{title:"显示顺序",key:"displayOrder",element:"number"}],void(Xe.formTextAreaEl=[]);case"FIXED":return Xe.formInputEl=[{title:"字段名称",key:"resultName",element:"input"}],Xe.formTimeAndNumber=[{title:"显示顺序",key:"displayOrder",element:"number"}],void("NUM"===Ve.value.resultType?Xe.formTimeAndNumber.push({title:"固定计算系数",key:"fixedCoefficient",element:"number"}):"STRING"===Ve.value.resultType?Xe.formInputEl.push({title:"固定值",key:"fixedCoefficient",element:"input"}):Xe.formTimeAndNumber.push({title:"固定日期",key:"fixedCoefficient",element:"date"}));case"DEPEND":return Xe.formInputEl=[{title:"字段名称",key:"resultName",element:"input"},{title:"绑定分类关系",key:"dependCode",element:"input",type:"dialog"}],void(Xe.formTimeAndNumber=[{title:"显示顺序",key:"displayOrder",element:"number"}]);case"EQUATION":return Xe.formInputEl=[{title:"字段名称",key:"resultName",element:"input"}],void(Xe.formTimeAndNumber=[{title:"显示顺序",key:"displayOrder",element:"number"}]);default:return}},Ke=e=>{(0,t.Y3)((()=>{"TABLE"===e?("绑定数据表"===Xe.formInputEl[1].title&&(Xe.formInputEl[1].disabled=!1),Ve.value.getDataFrom=e,be.$refs.dialogForm.updateDialogInput({orderName:"",orderTable:"",getDataFrom:"",groupByTable:""})):("绑定数据表"===Xe.formInputEl[1].title&&(Xe.formInputEl[1].disabled=!0),Ve.value.getDataFrom=e,be.$refs.dialogForm.updateDialogInput({getDataFrom:e,orderName:xe.value.schemeMain.name,orderTable:xe.value.schemeMain.schemeCode,groupByTable:xe.value.schemeMain.schemeCode}))}))},je=()=>{Ae.value=!0},Ye=(0,r.iH)({}),qe=async(e,a)=>{switch(e){case"SCHEME":return Ze.dataSource=new f.o({selectUri:"/colorful-fog/orderTable/select",tableHeader:[{label:"字段code",prop:"resultCode",width:200},{label:"字段名称",prop:"resultName",width:200},{label:"字段类型",prop:"type",width:200}],pageSize:10}),Ze.dataSource.forMatData=(e,a)=>"type"===a.property?ta[e[a.property]]:e[a.property]??"-",Ze.dataSource.tableData=xe.value.schemeDetailList,Ze.isShow=!0,void(Ze.chooseRow=e=>{"orderField"===a?(be.$refs.dialogForm.updateDialogInput({orderField:e.resultCode}),Ve.value.orderField=e.resultCode):"groupByFieldName"===a&&(be.$refs.dialogForm.updateDialogInput({groupByFieldName:e.resultName,groupByField:e.resultCode}),Ve.value.groupByFieldName=e.resultName),Ze.isShow=!1});case"archiveUserName":if(Ze.dataSource=new f.o({selectUri:"/colorful-fog/schemeUser/selectUserData",tableHeader:[],pageSize:10}),Ze.dataSource.searchData={dataSourceId:xe.value.schemeMain.dataSourceId,userDataTable:xe.value.schemeMain.userDataTable,userDataCodeField:xe.value.schemeMain.userDataCodeField,userDataNameField:xe.value.schemeMain.userDataNameField},Ze.dataSource.initData=async(e=Ze.dataSource)=>{var{data:e,code:a}=(await d.K.post(`${e.selectUri}?currentPage=${e.currentPage}&pageSize=`+e.pageSize,e.searchData))["data"];200===a&&(Ze.dataSource.tableData.length=0,Ze.dataSource.tableData.push(...e),Ze.dataSource.total=10)},await Ze.dataSource.initData(),Ze.dataSource.total=Ze.dataSource.tableData.length,0===Te.length){let e=[];Ze.dataSource.tableData.forEach((a=>{e.includes(a.name)||(Te.push({value:a.name+" "+a.code,label:a.name}),e.push(a.name))}))}return void(De.value=!0);case"dataSourceName":return Ze.useChoose=!1,Ze.searchPlaceholde="输入数据库名称进行搜索",Ze.chooseRow=e=>{xe.value.schemeMain.dataSourceName=e.sourceName,xe.value.schemeMain.dataSourceId=e.id,Ze.isShow=!1},Ze.doSearch=e=>{Ze.dataSource.searchData={},e&&(Ze.dataSource.searchData.sourceName=e),Ze.dataSource.initData()},Ze.dataSource=new f.o({selectUri:"/colorful-fog/dataSource/list",tableHeader:[{label:"数据库名称",prop:"sourceName",width:200},{label:"数据库Code",prop:"sourceCode",width:200}],pageSize:10}),Ze.dataSource.forMatData=(e,a)=>e[a.property]??"-",Ze.dataSource.initData=async(e=Ze.dataSource)=>{var{data:a,code:l}=(await d.K.post(`${e.selectUri}?currentPage=${e.currentPage}&pageSize=`+e.pageSize,e.searchData))["data"];200===l&&(e.total=a.length,e.tableData=a)},await Ze.dataSource.initData(),void(Ze.isShow=!0);case"[!]OR":case"[!]AND":return void be.$prompt("请输入表达式名称","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((({value:a})=>{Ue(),(0,v.aX)({schemeCode:xe.value.schemeMain.schemeCode,conditionField:"",publicConnect:e,conditionName:a}).then((e=>{200===e.code&&(Ye.value=e.data,Le.value=!0)}))})).catch((()=>{}));case"granularity":return Ze.useChoose=!1,Ze.searchPlaceholde="输入单据名称进行搜索",Ze.chooseRow=e=>{xe.value.schemeMain.granularity=e.orderTable,xe.value.schemeDetailList.length=0,Ze.isShow=!1},Ze.doSearch=e=>{Ze.dataSource.searchData={},e&&(Ze.dataSource.searchData.orderName=e),Ze.dataSource.initData()},Ze.dataSource=new f.o({selectUri:"/colorful-fog/orderTable/select",tableHeader:[{label:"单据名称",prop:"orderName",width:200},{label:"单据关联表",prop:"orderTable",width:200},{label:"备注",prop:"comment",width:200}],pageSize:10}),Ze.dataSource.forMatData=(e,a)=>e[a.property]??"-",await Ze.dataSource.initData(),void(Ze.isShow=!0);case"schemeDetail":return Pe(["ORDER_DATA"]),void(Xe.isShow=!0);case"groupByTable":case"timeFieldTable":case"userDataTable":case"belongRelTableName":case"groupByField":case"orderName":return Ze.searchPlaceholde="输入单据表名称进行搜索",Ze.chooseRow=a=>{"belongRelTableName"===e?(xe.value.schemeMain.belongRelTableName=a.orderTable,xe.value.schemeMain.orderName=a.orderName,Ze.isShow=!1,qe("belongRelTableField")):("userDataTable"===e?xe.value.schemeMain.userDataTable=a.orderTable:"timeFieldTable"===e?xe.value.schemeMain.timeFieldTable=a.orderTable:"groupByTable"===e?(Ve.value.groupByTable=a.orderTable,be.$refs.dialogForm.updateDialogInput({groupByTable:a.orderTable})):(be.$refs.dialogForm.updateDialogInput({orderName:a.orderName,orderTable:a.orderTable}),Ve.value.orderTable=a.orderTable,Ve.value.orderName=a.orderName),Ze.isShow=!1)},Ze.doSearch=e=>{Ze.dataSource.searchData={},e&&(Ze.dataSource.searchData.orderName=e),Ze.dataSource.initData()},Ze.dataSource=new f.o({selectUri:"/colorful-fog/orderTable/select",tableHeader:[{label:"单据名称",prop:"orderName",width:200},{label:"单据关联表",prop:"orderTable",width:200},{label:"单据关联表名称",prop:"orderTableName",width:200},{label:"类型",prop:"type",width:200}],pageSize:10}),Ze.dataSource.forMatData=(e,a)=>"type"===a.property?"MAIN"===e[a.property]?"主表":"明细":e[a.property]??"-",await Ze.dataSource.initData(),void(Ze.isShow=!0);case"timeFieldName":case"userDataNameField":case"userDataCodeField":case"belongRelTableField":case"groupByFieldName":case"orderField":return"SCHEME"===Ve.value.getDataFrom?void qe("SCHEME",e):(Ze.useChoose=!1,Ze.searchPlaceholde="输入字段名称进行搜索",Ze.chooseRow=a=>{"belongRelTableField"===e?xe.value.schemeMain.belongRelTableField=a.field:"userDataCodeField"===e?xe.value.schemeMain.userDataCodeField=a.field:"userDataNameField"===e?xe.value.schemeMain.userDataNameField=a.field:"groupByFieldName"===e?(be.$refs.dialogForm.updateDialogInput({groupByFieldName:a.fieldName,groupByField:a.field}),Ve.value.groupByFieldName=a.fieldName,xe.value.schemeMain.groupByFieldName=a.fieldName,xe.value.schemeMain.groupByField=a.field):"timeFieldName"===e?(xe.value.schemeMain.timeFieldName=a.fieldName,xe.value.schemeMain.timeField=a.field):(be.$refs.dialogForm.updateDialogInput({orderField:a.field}),Ve.value.orderField=a.field),Ze.isShow=!1},Ze.doSearch=a=>{Ze.dataSource.searchData="belongRelTableField"===e?{tableName:xe.value.schemeMain.belongRelTableName}:{tableName:Ve.value.orderTable},a&&(Ze.dataSource.searchData.fieldName=a),Ze.dataSource.initData()},Ze.dataSource=new f.o({selectUri:"/colorful-fog/tableFiled/select",tableHeader:[{label:"字段key",prop:"field",width:200},{label:"字段名",prop:"fieldName",width:200},{label:"数据类型",prop:"type",width:200}],pageSize:10}),Ze.dataSource.searchData="groupByTable"===e?{tableName:Ve.value.groupByTable}:"timeFieldName"===e?{tableName:xe.value.schemeMain.timeFieldTable}:"userDataCodeField"===e||"userDataNameField"===e?{tableName:xe.value.schemeMain.userDataTable}:"belongRelTableField"===e?{tableName:xe.value.schemeMain.belongRelTableName}:{tableName:Ve.value.orderTable},Ze.dataSource.forMatData=(e,a)=>e[a.property]??"-",await Ze.dataSource.initData(),void(Ze.isShow=!0));case"dependCode":return Ze.useChoose=!1,Ze.searchPlaceholde="输入分类关系名称进行搜索",Ze.chooseRow=e=>{be.$refs.dialogForm.updateDialogInput({dependCode:e.dependCode}),Ve.value.dependCode=e.dependCode,Ze.isShow=!1},Ze.doSearch=e=>{Ze.dataSource.searchData={},e&&(Ze.dataSource.searchData.name=e),Ze.dataSource.initData()},Ze.dataSource=new f.o({selectUri:"/colorful-fog/dependMain/list",tableHeader:[{label:"分类Code",prop:"dependCode",width:200},{label:"分类名称",prop:"name",width:200},{label:"分类类型",prop:"dependType",width:200}],pageSize:10}),Ze.dataSource.forMatData=(e,a)=>"dependType"===a.property?"RANGE"===e[a.property]?"范围分类":"名词分类":e[a.property]??"-",await Ze.dataSource.initData(),void(Ze.isShow=!0);case"schemeName":return Ze.searchPlaceholde="输入账单计划名称进行搜索",Ze.chooseRow=e=>{e.children||(e.schemeCode===xe.value.schemeMain.schemeCode?be.$message.error("不可以选择当前的方案"):(e={sourceSchemeCode:e.schemeCode,targetSchemeCode:xe.value.schemeMain.schemeCode},(0,v.kN)(e).then((e=>{200===e.code&&(Ue(),be.$message.success("复制成功"),Ze.isShow=!1)}))))},Ze.doSearch=e=>{Ze.dataSource.searchData={},e&&(Ze.dataSource.searchData.name=e),Ze.dataSource.initData()},Ze.dataSource=new f.o({selectUri:"/colorful-fog/schemeMain/selectMenu",tableHeader:[{label:"账单名称",prop:"name",width:200},{label:"账单code",prop:"schemeCode",width:200},{label:"类型",prop:"billType",width:200}],pageSize:10}),Ze.dataSource.forMatData=(e,a)=>e[a.property]?"billType"===a.property?"PAY"===e[a.property]?"应付":"应收":e[a.property]??"-":"-",Ze.dataSource.initData=async(e=Ze.dataSource)=>{var{data:e,code:a}=(await d.K.post(`${e.selectUri}?currentPage=${e.currentPage}&pageSize=`+e.pageSize,e.searchData))["data"];200===a&&(Ze.dataSource.tableData.length=0,a=Object.entries(e).reduce(((e,a,l)=>(a={name:a[0],children:a[1],id:l+1,schemeCode:"-"},e.push(a),e)),[]),Ze.dataSource.tableData.push(...a),Ze.dataSource.total=Ze.dataSource.tableData.length)},await Ze.dataSource.initData(),void(Ze.isShow=!0)}},Ge=e=>{be.$refs.dialogForm.updateDialogInput({expression:e}),Ve.value.expression=e,Ae.value=!1},Xe=(0,r.qj)({isShow:!1,formInputEl:[],formSelectEl:[{title:"计算结果类型",key:"resultType",element:"radio",options:[{label:"数字",value:"NUM"},{label:"文本",value:"STRING"},{label:"日期",value:"DATE"}],rules:[{required:!0,message:"该项不能为空",trigger:"blur"}],change:e=>{Xe.formTimeAndNumber.splice(1,1),Ve.value.decimalPlaces=2,"NUM"===e&&Xe.formTimeAndNumber.push({title:"保留小数位数",key:"decimalPlaces",element:"number"}),"FIXED"===Ve.value.type&&(Xe.formInputEl.splice(1,1),Xe.formTimeAndNumber.splice(1,1),"NUM"===e?Xe.formTimeAndNumber.push({title:"固定计算系数",key:"fixedCoefficient",element:"number"}):"STRING"===e?Xe.formInputEl.push({title:"固定值",key:"fixedCoefficient",element:"input"}):Xe.formTimeAndNumber.push({title:"固定日期",key:"fixedCoefficient",element:"date"}))}},{title:"推送时是否隐藏",key:"hideWhenPush",element:"radio",options:[{label:"否",value:!1},{label:"是",value:!0}],rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]},{title:"导出时是否隐藏",key:"hideWhenExport",element:"radio",options:[{label:"否",value:!1},{label:"是",value:!0}],rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]}],formTimeAndNumber:[],formTextAreaEl:[],emitOpenDialog:e=>{qe(e)},inputDone:async e=>{e={...e},e.fixedCoefficient&&("NUM"===e.resultType?e.fixedCoefficient=+e.fixedCoefficient:"DATE"===e.resultType&&(e.fixedCoefficient=Date.parse(e.fixedCoefficient))),"FOR_MUL_TAG"!==e.type&&"SINGLE_TAG"!==e.type||(e.expression=e.singleType+`(${e.text1})?${e.text2}:`+e.text3),e.id?200===(await(0,v.u0)([e])).code&&(be.$message.success("更新成功"),Ue(),Xe.isShow=!1):(e.schemeCode=xe.value.schemeMain.schemeCode,200===(await(0,v.g9)([e])).code&&(be.$message.success("新增成功"),Ue(),Xe.isShow=!1))}}),Ze=(0,r.qj)({isShow:!1,dataSource:null,searchPlaceholde:"",doSearch:e=>{},chooseRow:e=>{}}),Qe=e=>{var a=["belongRelTableField","belongRelTableName","billType","dataSourceId","dataSourceName","executionTime","executionUnit","granularity","name","sort","userDataCodeField","userDataNameField","userDataTable","timeField","timeFieldName","timeFieldTable","timeFormula"];for(let l=0;l<a.length;l++)if(!e[a[l]]&&0!==e[a[l]]||0===e[a[l]].toString().length)return!1;return!0};let Je=(e,a)=>{if(e)return e=e.toString().split("."),"MONTHLY"===a?(new be.$DataTool).timeStamp2Time(Date.parse(new Date)+2592e6*Number(e[0])).split("-").slice(0,2).join("-")+"-"+e[1].padStart(2,"0"):(new be.$DataTool).timeStamp2Time(Date.parse(new Date)+864e5*Number(e[0]))+" "+e[1]+":00:00"};const ea=()=>{if(xe.value.schemeMain.sort=l.addType,Qe(xe.value.schemeMain)){var e,a,t;if("MONTHLY"===xe.value.schemeMain.executionUnit?(a=(new be.$DataTool).timeStamp2Time(Date.parse(new Date)).split("-"),e=xe.value.schemeMain.timeFormula[0].split("-"),t=xe.value.schemeMain.timeFormula[1].split("-"),xe.value.schemeMain.timeFormulaStart=Number(e[1])-Number(a[1])+"."+Number(e[2]),xe.value.schemeMain.timeFormulaEnd=Number(a[1])-Number(t[1])+"."+Number(t[2])):(e=(new be.$DataTool).timeStamp2Time(Date.parse(new Date)),a=xe.value.schemeMain.timeFormula[0].split(" "),t=xe.value.schemeMain.timeFormula[1].split(" "),xe.value.schemeMain.timeFormulaStart=(Date.parse(a[0])-Date.parse(e))/864e5+"."+a[1].split(":")[0],xe.value.schemeMain.timeFormulaEnd=(Date.parse(t[0])-Date.parse(e))/864e5+"."+t[1].split(":")[0]),-1===Ce.value)return xe.value.schemeMain.sort=l.addType,Qe(xe.value.schemeMain)?void(0,v.gV)(xe.value.schemeMain).then((e=>{200===e.code&&(be.$message.success("新增成功"),Ce.value=e.data.id,Ue())})):void be.$message.error("请将信息填写完整");(0,v.WJ)(xe.value.schemeMain).then((e=>{200===e.code&&be.$message.success("更新成功")}))}else be.$message.error("请将信息填写完整")},aa=()=>{let e={schemeCode:xe.value.schemeMain.schemeCode,tableName:xe.value.schemeMain.userDataTable,entityList:Se.value.map((e=>({schemeCode:xe.value.schemeMain.schemeCode,archiveUserCode:e.split(" ")[1],archiveUserName:e.split(" ")[0]})))};be.$alert("确认保存？会覆盖以前保存的数据","提示",{type:"info",icon:"InfoFilled",confirmButtonText:"确定继续",callback:a=>{"confirm"===a&&(0,v.v8)(e).then((e=>{200===e.code&&be.$message.success("保存成功")}))}})},la=async e=>{e=(await(new be.$DataTool).xlsx2DataObject(e.raw)).map((e=>e["用户名称"]));let a={dataSourceId:xe.value.schemeMain.dataSourceId,userDataTable:xe.value.schemeMain.userDataTable,userDataCodeField:xe.value.schemeMain.userDataCodeField,userDataNameField:xe.value.schemeMain.userDataNameField,userNameList:e,schemeCode:xe.value.schemeMain.schemeCode};be.$alert("是否确认导入？","提示",{type:"info",icon:"InfoFilled",confirmButtonText:"确定",callback:e=>{"confirm"===e&&(0,v.Z$)(a).then((e=>{200===e.code&&be.$alert("导入成功","提示",{type:"success",icon:"InfoFilled",showCancelButton:!1,callback:()=>{Ue()}})}))}})},ta={FIXED:"固定系数",ORDER_DATA:"原单据字段值",SUM:"汇总",DEPEND:"分类系数",EQUATION:"自定义公式",FOR_MUL_TAG:"循环标记"},oa=(0,r.qj)({resultNameList:[],resultDataList:[],originNameList:[],originDataList:[]}),ra=()=>{oa.resultNameList=[],(0,v.fm)({code:xe.value.schemeMain.schemeCode}).then((e=>{oa.resultNameList=e.data.resultNameList,oa.resultDataList=e.data.billDataList,oa.originNameList=e.data.originNameList,oa.originDataList=e.data.originDataList}))},ia=(0,r.qj)([]),da=(e,a)=>{e===xe.value.schemeMain.executionUnit!==e&&(a&&(xe.value.schemeMain.timeFormula=[]),ia.length=0,"DAILY"===e?ia.push(...Array.from({length:24},((e,a)=>({label:a+"点",value:a})))):ia.push(...Array.from({length:31},((e,a)=>({label:a+1+"日",value:a+1})))))};let sa="";const na=e=>{sa="display",xe.value.schemeDetailList.sort(((e,a)=>e.displayOrder-a.displayOrder))},ua=async()=>{Ze.useChoose=!1,Ze.searchPlaceholde="输入单据表名称进行搜索",Ze.chooseRow=e=>{be.$refs.dialogForm.updateDialogInput({orderName:e.orderName,orderTable:e.orderTable}),Ve.value.orderTable=e.orderTable,Ve.value.orderName=e.orderName,Ze.isShow=!1,(async()=>{Ze.useChoose=!0,Ze.searchPlaceholde="输入字段名称进行搜索",Ze.submit=async e=>{let a=[];Ze.dataSource.selections.forEach(((e,l)=>{let t={schemeCode:xe.value.schemeMain.schemeCode,calculateOrder:Ve.value.calculateOrder+l,displayOrder:Ve.value.displayOrder+l,orderTable:Ve.value.orderTable,orderName:Ve.value.orderName,orderField:e.field,resultType:"STRING",resultName:e.fieldName,type:"ORDER_DATA",getDataFrom:"TABLE"};a.push(t)}));let l=await(0,v.g9)(a);200===l.code&&(be.$message.success("新增成功"),Ue(),Ze.isShow=!1)},Ze.doSearch=e=>{Ze.dataSource.searchData={tableName:Ve.value.orderTable},e&&(Ze.dataSource.searchData.fieldName=e),Ze.dataSource.initData()},Ze.dataSource=new f.o({selectUri:"/colorful-fog/tableFiled/select",tableHeader:[{label:"字段key",prop:"field",width:200},{label:"字段名",prop:"fieldName",width:200},{label:"数据类型",prop:"type",width:200}],pageSize:10}),Ze.dataSource.searchData={tableName:Ve.value.orderTable},Ze.dataSource.forMatData=(e,a)=>e[a.property]??"-",await Ze.dataSource.initData(),Ze.isShow=!0})()},Ze.doSearch=e=>{Ze.dataSource.searchData={},e&&(Ze.dataSource.searchData.orderName=e),Ze.dataSource.initData()},Ze.dataSource=new f.o({selectUri:"/colorful-fog/orderTable/select",tableHeader:[{label:"单据名称",prop:"orderName",width:200},{label:"单据关联表",prop:"orderTable",width:200},{label:"单据关联表名称",prop:"orderTableName",width:200},{label:"类型",prop:"type",width:200}],pageSize:10}),Ze.dataSource.forMatData=(e,a)=>"type"===a.property?"MAIN"===e[a.property]?"主表":"明细":e[a.property]??"-",await Ze.dataSource.initData(),Ze.isShow=!0};return(a,l)=>{const d=(0,t.up)("el-button"),h=(0,t.up)("el-input");var we=(0,t.up)("el-page-header");const Ee=(0,t.up)("Warning"),Qe=(0,t.up)("el-icon"),Je=(0,t.up)("el-popover"),ta=(0,t.up)("el-radio"),sa=(0,t.up)("el-radio-group"),na=(0,t.up)("el-option"),ca=(0,t.up)("el-select"),ma=(0,t.up)("el-date-picker");var pa=(0,t.up)("el-card");const ha=(0,t.up)("el-upload"),fa=(0,t.up)("el-checkbox"),va=(0,t.up)("el-tag"),ga=(0,t.up)("el-dropdown-item"),ya=(0,t.up)("el-dropdown-menu"),ba=(0,t.up)("el-dropdown"),wa=(0,t.up)("CircleClose"),Da=(0,t.up)("el-cascader"),Sa=(0,t.up)("el-form-item"),Ta=(0,t.up)("xButton");var _a=(0,t.Q2)("loading");return(0,t.wy)(((0,t.wg)(),(0,t.iD)("div",{class:(0,o.C_)(["container",{hide:Oe.value}])},[(0,t._)("div",g,[(0,t._)("div",null,[(0,t._)("h3",y,(0,o.zw)(e.addType),1),(0,t.Wm)(we,null,{icon:(0,t.w5)((()=>[(0,t.Wm)(d,{type:"info",size:"small",onClick:Ue},{default:(0,t.w5)((()=>[(0,t.Uk)(" 刷新数据 ")])),_:1}),(0,t.Wm)(d,{type:"danger",size:"small",onClick:$e},{default:(0,t.w5)((()=>[(0,t.Uk)(" 返回 ")])),_:1})])),title:(0,t.w5)((()=>[b])),content:(0,t.w5)((()=>[(0,t._)("div",w,[D,(0,t.Wm)(h,{modelValue:xe.value.schemeMain.name,"onUpdate:modelValue":l[0]||(l[0]=e=>xe.value.schemeMain.name=e),class:"ml10",style:{width:"280px"},placeholder:"请输入计划名称"},null,8,["modelValue"]),S])])),_:1})]),(0,t._)("div",T,[(0,t.Wm)(pa,{class:"box-card mb30"},{header:(0,t.w5)((()=>[(0,t._)("div",_,[N,(0,t.Wm)(Je,{placement:"top",width:"300","hide-after":0},{reference:(0,t.w5)((()=>[(0,t.Wm)(Qe,{style:{color:"orange"},class:"ml6"},{default:(0,t.w5)((()=>[(0,t.Wm)(Ee)])),_:1})])),default:(0,t.w5)((()=>[(0,t.Uk)(" 方案的基本信息 ")])),_:1}),(0,t.Wm)(d,{type:"primary",size:"small",class:"ml10",color:"#4a78bd",onClick:ea},{default:(0,t.w5)((()=>[(0,t.Uk)(" 提交保存 ")])),_:1})])])),default:(0,t.w5)((()=>[(0,t._)("div",k,[(0,t._)("div",null,[M,(0,t.Wm)(sa,{modelValue:xe.value.schemeMain.billType,"onUpdate:modelValue":l[1]||(l[1]=e=>xe.value.schemeMain.billType=e),class:"ml-4"},{default:(0,t.w5)((()=>[(0,t.Wm)(ta,{value:"PAY",label:"PAY"},{default:(0,t.w5)((()=>[(0,t.Uk)(" 应付 ")])),_:1}),(0,t.Wm)(ta,{value:"COST",label:"COST"},{default:(0,t.w5)((()=>[(0,t.Uk)(" 应收 ")])),_:1})])),_:1},8,["modelValue"])]),(0,t._)("div",x,[(0,t._)("div",C,[U,(0,t.Wm)(h,{modelValue:xe.value.schemeMain.dataSourceName,"onUpdate:modelValue":l[3]||(l[3]=e=>xe.value.schemeMain.dataSourceName=e),style:{width:"260px"},placeholder:"请选择",class:"input-with-select",disabled:""},{append:(0,t.w5)((()=>[(0,t.Wm)(d,{icon:"Edit",disabled:-1!==Ce.value,onClick:l[2]||(l[2]=e=>qe("dataSourceName"))},null,8,["disabled"])])),_:1},8,["modelValue"])]),(0,t._)("div",F,[E,(0,t.Wm)(h,{modelValue:xe.value.schemeMain.granularity,"onUpdate:modelValue":l[5]||(l[5]=e=>xe.value.schemeMain.granularity=e),style:{width:"260px"},placeholder:"请选择",class:"input-with-select",disabled:""},{append:(0,t.w5)((()=>[(0,t.Wm)(d,{icon:"Edit",disabled:-1!==Ce.value,onClick:l[4]||(l[4]=e=>qe("granularity"))},null,8,["disabled"])])),_:1},8,["modelValue"])]),(0,t._)("div",W,[I,(0,t.Wm)(h,{modelValue:xe.value.schemeMain.belongRelTableField,"onUpdate:modelValue":l[7]||(l[7]=e=>xe.value.schemeMain.belongRelTableField=e),style:{width:"260px"},placeholder:"请选择",class:"input-with-select",disabled:""},{append:(0,t.w5)((()=>[(0,t.Wm)(d,{icon:"Edit",disabled:-1!==Ce.value,onClick:l[6]||(l[6]=e=>qe("belongRelTableName"))},null,8,["disabled"])])),_:1},8,["modelValue"])])]),(0,t._)("div",R,[O,(0,t.Wm)(h,{modelValue:xe.value.schemeMain.timeFieldTable,"onUpdate:modelValue":l[9]||(l[9]=e=>xe.value.schemeMain.timeFieldTable=e),style:{width:"260px"},placeholder:"请选择",class:"input-with-select",disabled:""},{append:(0,t.w5)((()=>[(0,t.Wm)(d,{icon:"Edit",disabled:-1!==Ce.value,onClick:l[8]||(l[8]=e=>qe("timeFieldTable"))},null,8,["disabled"])])),_:1},8,["modelValue"]),V,(0,t.Wm)(h,{modelValue:xe.value.schemeMain.timeFieldName,"onUpdate:modelValue":l[11]||(l[11]=e=>xe.value.schemeMain.timeFieldName=e),style:{width:"260px"},placeholder:"请选择",class:"input-with-select",disabled:""},{append:(0,t.w5)((()=>[(0,t.Wm)(d,{icon:"Edit",disabled:-1!==Ce.value,onClick:l[10]||(l[10]=e=>qe("timeFieldName"))},null,8,["disabled"])])),_:1},8,["modelValue"])]),(0,t._)("div",A,[L,(0,t.Wm)(ca,{modelValue:xe.value.schemeMain.executionUnit,"onUpdate:modelValue":l[12]||(l[12]=e=>xe.value.schemeMain.executionUnit=e),class:"m-2",placeholder:"选择执行频率",style:{width:"260px"},onChange:l[13]||(l[13]=e=>da(e,1))},{default:(0,t.w5)((()=>[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(Me,(e=>(0,t.Wm)(na,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue"]),(0,t._)("span",B,(0,o.zw)("MONTHLY"===xe.value.schemeMain.executionUnit?"每月":"每日"),1),(0,t.Wm)(ca,{modelValue:xe.value.schemeMain.executionTime,"onUpdate:modelValue":l[14]||(l[14]=e=>xe.value.schemeMain.executionTime=e),class:"m-2",placeholder:"选择执行时间",style:{width:"200px"}},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(ia,(e=>((0,t.wg)(),(0,t.j4)(na,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),$]),(0,t._)("div",H,[z,(0,t.Wm)(ma,{modelValue:xe.value.schemeMain.timeFormula,"onUpdate:modelValue":l[15]||(l[15]=e=>xe.value.schemeMain.timeFormula=e),type:"MONTHLY"===xe.value.schemeMain.executionUnit?"daterange":"datetimerange","value-format":"MONTHLY"===xe.value.schemeMain.executionUnit?"YYYY-MM-DD":"YYYY-MM-DD H:mm:ss","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",style:{width:"400px"}},null,8,["modelValue","type","value-format"])])])])),_:1}),(0,t.Wm)(pa,{class:"box-card mb30"},{header:(0,t.w5)((()=>[(0,t._)("div",P,[K,(0,t.Wm)(Je,{placement:"top",width:"300","hide-after":0},{reference:(0,t.w5)((()=>[(0,t.Wm)(Qe,{style:{color:"orange"},class:"ml6"},{default:(0,t.w5)((()=>[(0,t.Wm)(Ee)])),_:1})])),default:(0,t.w5)((()=>[(0,t.Uk)(" 方案绑定的用户，谁使用该方案 ")])),_:1}),-1!==Ce.value?((0,t.wg)(),(0,t.j4)(ha,{key:0,class:"inline-block ml10",accept:".xlsx, .xls","on-change":la,"show-file-list":!1,"auto-upload":!1},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{color:"#4a78bd",size:"small"},{default:(0,t.w5)((()=>[(0,t.Uk)(" 批量导入绑定 ")])),_:1})])),_:1})):(0,t.kq)("",!0)])])),default:(0,t.w5)((()=>[(0,t._)("div",null,[(0,t._)("div",j,[(0,t._)("div",Y,[(0,t.Wm)(Je,{placement:"top",width:"300","hide-after":0},{reference:(0,t.w5)((()=>[(0,t.Wm)(Qe,{style:{color:"orange"},class:"mr6"},{default:(0,t.w5)((()=>[(0,t.Wm)(Ee)])),_:1})])),default:(0,t.w5)((()=>[(0,t.Uk)(" 这份账单的所属人记录在哪份表单中 ")])),_:1}),q,(0,t.Wm)(h,{modelValue:xe.value.schemeMain.userDataTable,"onUpdate:modelValue":l[17]||(l[17]=e=>xe.value.schemeMain.userDataTable=e),style:{width:"260px"},placeholder:"请选择",class:"input-with-select",disabled:""},{append:(0,t.w5)((()=>[(0,t.Wm)(d,{icon:"Edit",disabled:-1!==Ce.value,onClick:l[16]||(l[16]=e=>qe("userDataTable"))},null,8,["disabled"])])),_:1},8,["modelValue"])]),(0,t._)("div",G,[(0,t.Wm)(Je,{placement:"top",width:"300","hide-after":0},{reference:(0,t.w5)((()=>[(0,t.Wm)(Qe,{style:{color:"orange"},class:"mr6"},{default:(0,t.w5)((()=>[(0,t.Wm)(Ee)])),_:1})])),default:(0,t.w5)((()=>[(0,t.Uk)(" 档案中用户的哪个字段和订单的用户字段关联 ")])),_:1}),X,(0,t.Wm)(h,{modelValue:xe.value.schemeMain.userDataCodeField,"onUpdate:modelValue":l[19]||(l[19]=e=>xe.value.schemeMain.userDataCodeField=e),style:{width:"260px"},placeholder:"请选择",class:"input-with-select",disabled:""},{append:(0,t.w5)((()=>[(0,t.Wm)(d,{icon:"Edit",disabled:-1!==Ce.value,onClick:l[18]||(l[18]=e=>qe("userDataCodeField"))},null,8,["disabled"])])),_:1},8,["modelValue"])]),(0,t._)("div",Z,[(0,t.Wm)(Je,{placement:"top",width:"300","hide-after":0},{reference:(0,t.w5)((()=>[(0,t.Wm)(Qe,{style:{color:"orange"},class:"mr6"},{default:(0,t.w5)((()=>[(0,t.Wm)(Ee)])),_:1})])),default:(0,t.w5)((()=>[(0,t.Uk)(" 显示档案中用户名称的字段是哪个 ")])),_:1}),Q,(0,t.Wm)(h,{modelValue:xe.value.schemeMain.userDataNameField,"onUpdate:modelValue":l[21]||(l[21]=e=>xe.value.schemeMain.userDataNameField=e),style:{width:"260px"},placeholder:"请选择",class:"input-with-select",disabled:""},{append:(0,t.w5)((()=>[(0,t.Wm)(d,{icon:"Edit",disabled:-1!==Ce.value,onClick:l[20]||(l[20]=e=>qe("userDataNameField"))},null,8,["disabled"])])),_:1},8,["modelValue"])])]),-1!==Ce.value?((0,t.wg)(),(0,t.iD)("div",J,[De.value?((0,t.wg)(),(0,t.iD)("div",ee,[(0,t.Wm)(ca,{modelValue:Se.value,"onUpdate:modelValue":l[23]||(l[23]=e=>Se.value=e),multiple:"",placeholder:"选择绑定用户",filterable:"",style:{width:"100%"},"collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":14},{header:(0,t.w5)((()=>[(0,t.Wm)(fa,{modelValue:_e.value,"onUpdate:modelValue":l[22]||(l[22]=e=>_e.value=e),indeterminate:Ne.value,onChange:ke},{default:(0,t.w5)((()=>[(0,t.Uk)(" 选择所有用户 ")])),_:1},8,["modelValue","indeterminate"])])),default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(Te,(e=>((0,t.wg)(),(0,t.j4)(na,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),(0,t.Wm)(d,{class:"ml10",type:"success",size:"small",onClick:aa},{default:(0,t.w5)((()=>[(0,t.Uk)(" 保存 ")])),_:1})])):(0,t.kq)("",!0)])):(0,t.kq)("",!0)])])),_:1}),-1!==Ce.value?((0,t.wg)(),(0,t.j4)(pa,{key:0,class:"box-card mb30"},{header:(0,t.w5)((()=>[(0,t._)("div",ae,[le,(0,t.Wm)(Je,{placement:"top",width:"300","hide-after":0},{reference:(0,t.w5)((()=>[(0,t.Wm)(Qe,{style:{color:"orange"},class:"ml6"},{default:(0,t.w5)((()=>[(0,t.Wm)(Ee)])),_:1})])),default:(0,t.w5)((()=>[(0,t.Uk)(" 哪些账单会使用该方案，不符合条件的账单，将会被过滤 ")])),_:1})])])),default:(0,t.w5)((()=>[(0,t._)("div",null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(xe.value.conditionList,(e=>((0,t.wg)(),(0,t.j4)(va,{key:e,class:"mr20 mt10",closable:"","disable-transitions":!1,style:{cursor:"pointer"},size:"large",type:"warning",onClick:a=>{return l=e,Ye.value=l,void(Le.value=!0);var l},onClose:a=>{var l;l=e,be.$alert("是否确认删除当前生效条件？","提示",{type:"error",icon:"InfoFilled",confirmButtonText:"确定",callback:e=>{"confirm"===e&&(0,v.B6)([l.id]).then((e=>{200===e.code&&(be.$message.success("删除成功"),Ue())}))}})}},{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(e.conditionName),1)])),_:2},1032,["onClick","onClose"])))),128)),(0,t.Wm)(ba,{trigger:"click",onCommand:qe},{dropdown:(0,t.w5)((()=>[(0,t.Wm)(ya,null,{default:(0,t.w5)((()=>[(0,t.Wm)(ga,{command:"[!]AND"},{default:(0,t.w5)((()=>[(0,t.Uk)(" 关联条件：并且 ")])),_:1}),(0,t.Wm)(ga,{command:"[!]OR"},{default:(0,t.w5)((()=>[(0,t.Uk)(" 关联条件：或者 ")])),_:1})])),_:1})])),default:(0,t.w5)((()=>[(0,t.Wm)(d,{type:"warning",text:"",class:"mt10"},{default:(0,t.w5)((()=>[(0,t.Uk)(" + 新增条件 ")])),_:1})])),_:1})])])),_:1})):(0,t.kq)("",!0),-1!==Ce.value?((0,t.wg)(),(0,t.j4)(pa,{key:1,class:"box-card mb30"},{header:(0,t.w5)((()=>[(0,t._)("div",te,[oe,(0,t.Wm)(Je,{placement:"top",width:"300","hide-after":0},{reference:(0,t.w5)((()=>[(0,t.Wm)(Qe,{style:{color:"orange"},class:"ml6"},{default:(0,t.w5)((()=>[(0,t.Wm)(Ee)])),_:1})])),default:(0,t.w5)((()=>[(0,t.Uk)(" 最后生成的账单中包含哪些数据 ")])),_:1}),re,(0,t.Wm)(d,{type:"primary",size:"small",class:"ml10",style:{float:"right"},onClick:l[24]||(l[24]=e=>qe("schemeName"))},{default:(0,t.w5)((()=>[(0,t.Uk)(" + 复制其他方案基础字段 ")])),_:1})])])),default:(0,t.w5)((()=>[(0,t._)("div",ie,[(0,t.Wm)((0,r.SU)(c.J),{list:xe.value.schemeDetailList,"chosen-class":"chosen",group:"collect","force-fallback":"true",animation:"500",filter:".unmover","fallback-tolerance":4,onStart:l[26]||(l[26]=e=>Fe.value=!0),onEnd:We},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(xe.value.schemeDetailList,((e,a)=>{return(0,t.wg)(),(0,t.iD)("div",{key:e.id,class:(0,o.C_)(["tag mr20 mt10",(l=e).hideWhenPush&&l.hideWhenExport?"complex":l.hideWhenPush?"hideWhenPush":l.hideWhenExport?"hideWhenExport":"common"]),closable:"",size:"default","disable-transitions":!1,style:{cursor:"pointer"},onClick:a=>{return l=e,Ve.value.resultType=l.resultType,Pe([l.type]),Ve.value={...l,hideWhenPush:l.hideWhenPush??!1,hideWhenExport:l.hideWhenExport??!1},Ve.value.fixedCoefficient&&("NUM"===Ve.value.resultType?Ve.value.fixedCoefficient=+Ve.value.fixedCoefficient:"DATE"===Ve.value.resultType&&(Ve.value.fixedCoefficient=(new be.$DataTool).timeStamp2Time(+Ve.value.fixedCoefficient))),"SINGLE_TAG"!==Ve.value.type&&"FOR_MUL_TAG"!==Ve.value.type||(Ve.value.singleType=Ve.value.expression.split("(")[0],Ve.value.text1=Ve.value.expression.split("(")[1].split(")")[0],Ve.value.text2=Ve.value.expression.split("(")[1].split(")")[1].split("?")[1].split(":")[0],Ve.value.text3=Ve.value.expression.split("(")[1].split(")")[1].split("?")[1].split(":")[1]),void(Xe.isShow=!0);var l}},[(0,t.Uk)((0,o.zw)(e.resultName)+" ",1),(0,t.Wm)(Qe,{style:{"margin-left":"6px","font-size":"14px"},onClick:(0,i.iM)((a=>{var l;l=e,be.$alert("是否确认删除当前字段？","提示",{type:"error",icon:"InfoFilled",confirmButtonText:"确定",callback:e=>{"confirm"===e&&(0,v.dn)([l.id]).then((e=>{200===e.code&&(be.$message.success("删除成功"),Ue())}))}})}),["stop"])},{default:(0,t.w5)((()=>[(0,t.Wm)(wa)])),_:2},1032,["onClick"])],10,de);var l})),128)),Fe.value?((0,t.wg)(),(0,t.j4)(d,{key:0,type:"primary",class:"unmover",text:"",onClick:Ie},{default:(0,t.w5)((()=>[(0,t.Uk)(" 保存当前顺序 ")])),_:1})):(0,t.kq)("",!0),Fe.value?((0,t.wg)(),(0,t.j4)(d,{key:1,type:"primary",class:"unmover",text:"",onClick:Re},{default:(0,t.w5)((()=>[(0,t.Uk)(" 取消修改 ")])),_:1})):(0,t.kq)("",!0),(0,t.Wm)(d,{type:"primary",class:"unmover",text:"",onClick:l[25]||(l[25]=e=>qe("schemeDetail"))},{default:(0,t.w5)((()=>[(0,t.Uk)(" + 新增字段 ")])),_:1})])),_:1},8,["list","filter"])])])),_:1})):(0,t.kq)("",!0),-1!==Ce.value?((0,t.wg)(),(0,t.j4)(pa,{key:2,class:"box-card mb30"},{header:(0,t.w5)((()=>[(0,t._)("div",null,[se,(0,t.Wm)(d,{class:"ml10",onClick:ra},{default:(0,t.w5)((()=>[(0,t.Uk)(" 构建测试数据 ")])),_:1})])])),default:(0,t.w5)((()=>[(0,t._)("div",null,[(0,t.Wm)(n.default,{"test-data":oa},null,8,["test-data"])])])),_:1})):(0,t.kq)("",!0)])]),Ze.isShow?((0,t.wg)(),(0,t.j4)(p.Z,{key:0,ref:"dialogSearch","need-selection":Ze.useChoose,"use-choose":Ze.useChoose,"append-table-style":{background:"#126f9e",color:"#fff",borderColor:"rgba(192, 192, 192,.5)"},width:"60%","search-input-placeholder":Ze.searchPlaceholde,"is-show":Ze.isShow,"data-source":Ze.dataSource,title:"选择数据","is-show-search-input":"",loading:(0,r.SU)(f.V),onCloseDialog:l[27]||(l[27]=e=>Ze.isShow=!1),onDoDialogSearch:Ze.doSearch,onChooseRow:Ze.chooseRow,onSubmit:Ze.submit},null,8,["need-selection","use-choose","append-table-style","search-input-placeholder","is-show","data-source","loading","onDoDialogSearch","onChooseRow","onSubmit"])):(0,t.kq)("",!0),Xe.isShow?((0,t.wg)(),(0,t.j4)(m.Z,{key:1,ref:"dialogForm",width:"60%",loading:(0,r.SU)(f.V),"form-data":Ve.value,"is-show":Xe.isShow,title:"请填写相关信息","form-input-el":Xe.formInputEl,"form-select-el":Xe.formSelectEl,"form-text-area-el":Xe.formTextAreaEl,"form-upload-el":Xe.formUploadEl,"form-time-and-number":Xe.formTimeAndNumber,onCloseDialog:l[35]||(l[35]=e=>Xe.isShow=!1),onEmitOpenDialog:Xe.emitOpenDialog,onInputDone:Xe.inputDone},{customOperation:(0,t.w5)((()=>[(0,t._)("div",ne,[ue,(0,t.Wm)(Da,{modelValue:Ve.value.type,"onUpdate:modelValue":l[28]||(l[28]=e=>Ve.value.type=e),style:{width:"220px"},options:He,placeholder:"请选择系数类型",disabled:Ve.value.resultCode&&0!==Ve.value.resultCode.length,onChange:Pe},null,8,["modelValue","disabled"]),["COUNT","FOR_MUL_TAG","MAX","MIN","SUM"].includes(Ve.value.type)?((0,t.wg)(),(0,t.iD)("span",ce," 请选择字段来源：")):(0,t.kq)("",!0),["COUNT","FOR_MUL_TAG","MAX","MIN","SUM"].includes(Ve.value.type)?((0,t.wg)(),(0,t.j4)(ca,{key:1,modelValue:Ve.value.getDataFrom,"onUpdate:modelValue":l[29]||(l[29]=e=>Ve.value.getDataFrom=e),disabled:["SUM","COUNT","MAX","MIN","FOR_MUL_TAG"].includes(Ve.value.type),style:{width:"220px"},placeholder:"请选择字段来源",onChange:Ke},{default:(0,t.w5)((()=>[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(ze,(e=>(0,t.Wm)(na,{key:e.label,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue","disabled"])):(0,t.kq)("",!0),"ORDER_DATA"===Ve.value.type?((0,t.wg)(),(0,t.j4)(d,{key:2,class:"ml10",size:"small",onClick:ua},{default:(0,t.w5)((()=>[(0,t.Uk)(" 批量添加字段值 ")])),_:1})):(0,t.kq)("",!0)])])),append:(0,t.w5)((()=>["EQUATION"===Ve.value.type?((0,t.wg)(),(0,t.iD)("div",me,[(0,t.Wm)(Sa,{key:"expression",label:"计算公式",prop:"expression",class:"mr10",style:{width:"90%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(h,{modelValue:Ve.value.expression,"onUpdate:modelValue":l[30]||(l[30]=e=>Ve.value.expression=e),type:"textarea",placeholder:"请编写计算公式",autosize:{minRows:3,maxRows:6}},null,8,["modelValue"])])),_:1}),(0,t.Wm)(Ta,{type:"info",onClick:je},{default:(0,t.w5)((()=>[(0,t.Uk)(" 构造公式 ")])),_:1})])):(0,t.kq)("",!0),"SINGLE_TAG"===Ve.value.type||"FOR_MUL_TAG"===Ve.value.type?((0,t.wg)(),(0,t.iD)("div",pe,[(0,t.Wm)(Sa,{key:"singleType",label:"匹配类型",prop:"singleType",class:"mr10",style:{width:"90%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(sa,{modelValue:Ve.value.singleType,"onUpdate:modelValue":l[31]||(l[31]=e=>Ve.value.singleType=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(ta,{label:"anyMatch",value:"anyMatch"},{default:(0,t.w5)((()=>[(0,t.Uk)(" 任意一个符合 ")])),_:1}),(0,t.Wm)(ta,{label:"allMatch",value:"allMatch"},{default:(0,t.w5)((()=>[(0,t.Uk)(" 都符合 ")])),_:1}),(0,t.Wm)(ta,{label:"noneMatch",value:"noneMatch"},{default:(0,t.w5)((()=>[(0,t.Uk)(" 全不符合 ")])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(Sa,{key:"singleExpression",label:"匹配规则",prop:"singleExpression",class:"mr10",style:{width:"100%"}},{default:(0,t.w5)((()=>[(0,t._)("div",he,[(0,t._)("div",fe," 【"+(0,o.zw)(Ve.value.groupByFieldName)+"】 ",1),(0,t._)("div",ve,(0,o.zw)("noneMatch"===Ve.value.singleType?"所有都不符合":"anyMatch"===Ve.value.singleType?"在":"所有都符合"),1),(0,t.Wm)(h,{modelValue:Ve.value.text1,"onUpdate:modelValue":l[32]||(l[32]=e=>Ve.value.text1=e),class:"ml6 mr6",style:{width:"240px"},rows:2,type:"textarea",placeholder:"输入取值条件，用，隔开"},null,8,["modelValue"]),(0,t.Uk)(" "+(0,o.zw)("anyMatch"===Ve.value.singleType?"其中之一":"")+" ",1),ge,(0,t.Wm)(h,{modelValue:Ve.value.text2,"onUpdate:modelValue":l[33]||(l[33]=e=>Ve.value.text2=e),class:"ml6 mr6 mb10",style:{width:"240px"},rows:2,type:"textarea",placeholder:"输入要取的值"},null,8,["modelValue"]),ye,(0,t.Wm)(h,{modelValue:Ve.value.text3,"onUpdate:modelValue":l[34]||(l[34]=e=>Ve.value.text3=e),style:{width:"240px"},class:"ml6",rows:2,type:"textarea",placeholder:"输入要取的值"},null,8,["modelValue"])])])),_:1})])):(0,t.kq)("",!0)])),_:1},8,["loading","form-data","is-show","form-input-el","form-select-el","form-text-area-el","form-upload-el","form-time-and-number","onEmitOpenDialog","onInputDone"])):(0,t.kq)("",!0),(0,t.Wm)(s.default,{"is-show":Ae.value,list:xe.value.schemeDetailList,"default-expresion":Ve.value.expression,onInputDone:Ge,onCloseDialog:l[36]||(l[36]=e=>Ae.value=!1)},null,8,["is-show","list","default-expresion"]),(0,t.Wm)(u.default,{"is-show":Le.value,"condition-item":Ye.value,onInputDone:Ge,onCloseDialog:Be},null,8,["is-show","condition-item"])],2)),[[_a,(0,r.SU)(f.V)&&!Xe.isShow&&!Ze.isShow&&!Le.value&&!Ae.value]])}}};var be=(0,l(40089).Z)(a,[["__scopeId","data-v-e68377c8"]])}}]);