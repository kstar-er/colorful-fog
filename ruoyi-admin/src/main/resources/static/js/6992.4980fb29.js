"use strict";(self.webpackChunksystem=self.webpackChunksystem||[]).push([[6992,566,9653],{20566:function(e,a,t){t(57658),t(21703);var o=t(81081),r=t(82883);t(68521);const l=r.default["_state"];a.Z=class{constructor({modules:e="",selectUri:a="/",deleteUri:t="/",selectOneUri:o="/",pageSize:r=20,tableHeader:l=[]}={}){this.modules=e,this.selectUri=a,this.selectOneUri=o,this.deleteUri=t,this.searchData={},this.currentPage=1,this.pageSize=r,this.total=0,this.tableData=[],this.tableHeader=l,this.selections=[]}async initData(e=this,a){var{data:t,code:r}=(await o.K.post(`${e.selectUri}?pageNum=${e.currentPage}&pageSize=`+e.pageSize,e.searchData))["data"];200===r&&(e.total=t.total,e.tableData.length=0,e.tableData.push(...t.rows),a?.clearSelection())}currentPageChange(e,a=this,t){a.currentPage=e,a.initData(a,t)}pageSizeChange(e,a=this,t){a.currentPage=1,a.pageSize=e,a.initData(a,t)}search(e,a=this,t){a.searchData=e,a.currentPage=1,a.initData(a,t,!0)}async delete(e,a,t=this){var{code:e,message:r}=(await o.K.post(""+t.deleteUri,e))["data"];return 200===e?(t.initData(t,a),e):r}selectionChange(e,a=this){a.selections.length=0,a.selections.push(...e)}initTableHeader(e=this){if(0===e.tableHeader.length){if(0===e.modules.length||!l.data[e.modules])throw new Error("获取store中的表头, 请提供modules名");e.tableHeader.length=0,e.tableHeader.push(...l.data[e.modules].tableHeader.filter((e=>e.isShow)))}}async selectOne(e,a=this){a=(await o.K.post(a.selectOneUri+"?id="+e))["data"]["data"];return a}}},18757:function(e,a,t){t.d(a,{V:function(){return o.V},o:function(){return r}}),t(57658);var o=t(81081);class r extends t(20566).Z{constructor({modules:e="",selectUri:a="/",deleteUri:t="/",selectOneUri:o="/",pageSize:r=20,tableHeader:l}={}){super({modules:e,selectUri:a,deleteUri:t,selectOneUri:o,pageSize:r,tableHeader:l})}async initData(e=this,a){var{data:t,code:r}=(await o.K.post(`${e.selectUri}?currentPage=${e.currentPage}&pageSize=`+e.pageSize,e.searchData))["data"];200===r&&(e.total=t.pageInfo.total,e.tableData.length=0,e.tableData.push(...t.pageInfo.list),a?.clearSelection())}currentPageChange(e,a=this,t){a.currentPage=e,a.initData(a,t)}pageSizeChange(e,a=this,t){a.currentPage=1,a.pageSize=e,a.initData(a,t)}search(e,a=this,t){a.searchData=e,a.currentPage=1,a.initData(a,t,!0)}forMatData(e,a){var t={MAIN:"主表",DETAIL:"明细"};return"type"!==e?a&&0<a.toString().length||"number"==typeof a?a:"-":t[a]||a}async getStructure(e){var{code:e,data:a,msg:t}=(await o.K.post("/colorful-fog/orderTable/select?currentPage=1&pageSize=1",{tableId:e}))["data"];return 200===e?{data:a,code:e}:t}async deleteStructure(e){var{code:e,data:a,msg:t}=(await o.K.post("/colorful-fog/orderTable/delete",e))["data"];return 200===e?{data:a,code:e}:t}async addStructure(e){var{code:e,data:a,msg:t}=(await o.K.post("/colorful-fog/orderTable/add",e))["data"];return 200===e?{data:a,code:e}:t}async addStructureBatch(e){var{code:e,data:a,msg:t}=(await o.K.post("/colorful-fog/orderTable/addBatch",e))["data"];return 200===e?{data:a,code:e}:t}async updateStructure(e){var{code:e,data:a,msg:t}=(await o.K.post("/colorful-fog/orderTable/update",e))["data"];return 200===e?{data:a,code:e}:t}async getDetail(e){var{code:e,data:a,msg:t}=(await o.K.post("/colorful-fog/tableFiled/select?currentPage=1&pageSize=10",{id:e.id}))["data"];return 200===e?{data:a,code:e}:t}async addTableField(e){var{code:e,data:a,msg:t}=(await o.K.post("/colorful-fog/tableFiled/addTableField",e))["data"];return 200===e?{data:a,code:e}:t}async addTableFields(e){var{code:e,data:a,msg:t}=(await o.K.post("/colorful-fog/tableFiled/addTableFieldList",e))["data"];return 200===e?{data:a,code:e}:t}async updateTableFiled(e){var{code:e,data:a,msg:t}=(await o.K.post("/colorful-fog/tableFiled/updateTableField",e))["data"];return 200===e?{data:a,code:e}:t}async addForeignKeys(e){var{code:e,data:a,msg:t}=(await o.K.post("/colorful-fog/ForeignKey/addBatch",e))["data"];return 200===e?{data:a,code:e}:t}async deleteForeignKeys(e){var{code:e,data:a,msg:t}=(await o.K.post("/colorful-fog/ForeignKey/delete",e))["data"];return 200===e?{data:a,code:e}:t}async getTable(e){var{code:e,data:a,msg:t}=(await o.K.post("/colorful-fog/orderTable/getTableNameByDataSourceId",e))["data"];return 200===e?{data:a,code:e}:t}}},84961:function(e,a,t){t.r(a),t.d(a,{default:function(){return m}}),t(57658);var o=t(73396),r=t(87139),l=t(44870),s=t(88490),i=t(3431),d=t(73397),n=t(18757);const c={class:"fangan"},u={class:"settings"},g={class:"container",style:{width:"84%","min-height":"1000px"}},p=(e=>((0,o.dD)("data-v-3dc9dff2"),e=e(),(0,o.Cn)(),e))((()=>(0,o._)("div",{id:"container"},null,-1))),h={class:"contextmenu-content"},f={class:"list"},b=["onClick"];a={__name:"foreignDetailList",setup(e){const a=(0,o.FN)()["proxy"],t=(0,l.iH)(null),m=()=>{t.value=new n.o({modules:"structure",selectUri:"/colorful-fog/orderTable/select",pageSize:1e5});let e=[];t.value.initData(this).then((a=>{let o={nodes:[],edges:[]};o.nodes=t.value.tableData.map(((a,t)=>{var r=a.fieldList?a.fieldList.map((e=>({id:a.orderTable+"-"+e,group:"list",attrs:{portNameLabel:{text:e},portTypeLabel:{text:""}}}))):[{id:a.orderTable+"-none",group:"list",attrs:{portNameLabel:{text:"none"},portTypeLabel:{text:""}}}];return a.foreignKeyList&&a.foreignKeyList.forEach((a=>{e.includes(a.tableName+"-"+a.relTableForeignKey)||(e.push(a.tableName+"-"+a.relTableForeignKey),e.push(a.relTableForeignKey+"-"+a.tableName),o.edges.push({attrs:{line:{stroke:"#a2b1c3"}},source:{cell:a.tableName,port:a.tableName+"-"+a.relTableForeignKey},target:{cell:a.foreignTableName,port:a.foreignTableName+"-"+a.foreignKey}}))})),{id:a.orderTable,shape:"er-rect",label:a.orderTableName??a.orderTable,x:50+10*t,y:50+30*t,width:260,height:34,ports:r}})),w(o)}))},y=(0,l.iH)(null),w=e=>{i.kJ.registerPortLayout("erPortPosition",(e=>e.map(((e,a)=>({position:{x:0,y:34*(a+1)},angle:0})))),!0),i.kJ.registerNode("er-rect",{inherit:"rect",markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"}],attrs:{rect:{strokeWidth:1,stroke:"#5F95FF",fill:"#5F95FF"},label:{fontWeight:"bold",fill:"#ffffff",fontSize:14}},ports:{groups:{list:{markup:[{tagName:"rect",selector:"portBody"},{tagName:"text",selector:"portNameLabel"},{tagName:"text",selector:"portTypeLabel"}],attrs:{portBody:{width:260,height:34,strokeWidth:1,stroke:"#5F95FF",fill:"#EFF4FF",magnet:!0},portNameLabel:{ref:"portBody",refX:12,refY:12,fontSize:12},portTypeLabel:{ref:"portBody",refX:95,refY:12,fontSize:12}},position:"erPortPosition"}}}},!0),y.value=new i.kJ({container:document.getElementById("container"),panning:{enabled:!0,modifiers:"ctrl"},scroller:{enabled:!0,pannable:!0,pageVisible:!0,pageBreak:!1},mousewheel:{enabled:!0,modifiers:["ctrl","meta"]},grid:{visible:!0,size:10},width:"80%",height:1e3,background:{color:"#ffffff"},connecting:{allowBlank:!1,snap:!0,allowNode:!1,router:{name:"er",args:{offset:25,direction:"H"}},createEdge(){return new i.bn.kS({attrs:{line:{stroke:"#A2B1C3",strokeWidth:2}}})}}}),y.value.use(new d.Y({enabled:!0,rubberband:!0,showNodeSelectionBox:!0,showEdgeSelectionBox:!0,pointerEvents:"none"})),y.value.fromJSON(e),y.value.on("edge:click",(({x:e,y:a,edge:t})=>{D.style.display="none",D.style.display="block",D.style.left=e+"px",D.style.top=a+"px",S=t})),y.value.on("node:click",(({x:e,y:a,node:t})=>{D.style.display="none",D.style.display="block",D.style.left=e+"px",D.style.top=a+"px",v=t})),y.value.on("blank:click",(({})=>{D.style.display="none"})),y.value.on("edge:connected",(({edge:e})=>{if(-1!==e.store.data.source.port.indexOf("none"))return a.$message.error("不支持添加空白外键！"),e.remove(),!1})),y.value.on("cell:mouseenter",(({cell:e})=>{e.isNode()?e.addTools([{name:"boundary",args:{attrs:{fill:"#7c68fc",stroke:"#feb663","stroke-width":1,"fill-opacity":.2}}}]):e.removeTools()})),y.value.on("cell:mouseleave",(({cell:e})=>{e.removeTools()}))};let S=null,v=null,D=null;const k=()=>{},F=()=>{},T=(0,l.qj)([{cb:()=>{D.style.display="none",S.remove()},text:"删除"},{cb:()=>{D.style.display="none",x("addForeign",{tableName:v.id})},text:"添加外键"}]),N=(0,l.qj)({isShow:!1,dataSource:null,searchPlaceholde:"",doSearch:e=>{},chooseRow:e=>{}}),x=async(e,{tableName:a})=>{"addForeign"===e&&(N.useChoose=!1,N.searchPlaceholde="输入数据库名称进行搜索",N.chooseRow=e=>{-1!==v.port.ports[0].id.indexOf("none")&&v.removePort(v.port.ports[0].id),v.addPort({id:a+e.field,group:"list",attrs:{portNameLabel:{text:e.field}}}),N.isShow=!1},N.doSearch=e=>{N.dataSource.searchData={tableName:a},e&&(N.dataSource.searchData.fieldName=e),N.dataSource.initData()},N.dataSource=new n.o({selectUri:"/colorful-fog/tableFiled/select",tableHeader:[{label:"字段名",prop:"fieldName",width:200},{label:"字段",prop:"field",width:200}],pageSize:10}),N.dataSource.searchData={tableName:a},N.dataSource.forMatData=(e,a)=>e[a.property]??"-",await N.dataSource.initData(),N.isShow=!0)};return(0,o.bv)((()=>{(D=document.querySelector(".contextmenu-content")).style.display="none",m()})),(e,a)=>{var t=(0,o.up)("el-button");return(0,o.wg)(),(0,o.iD)("div",c,[(0,o._)("div",u,[(0,o.Uk)(" 配置 "),(0,o.Wm)(t,{onClick:k},{default:(0,o.w5)((()=>[(0,o.Uk)(" 撤销 ")])),_:1}),(0,o.Wm)(t,{onClick:F},{default:(0,o.w5)((()=>[(0,o.Uk)(" 转化为json ")])),_:1})]),(0,o._)("div",g,[p,(0,o._)("div",h,[(0,o._)("div",f,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(T,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.text,class:"item",onClick:e.cb},(0,r.zw)(e.text),9,b)))),128))])])]),N.isShow?((0,o.wg)(),(0,o.j4)(s.Z,{key:0,ref:"dialogSearch","need-selection":N.useChoose,"use-choose":N.useChoose,"append-table-style":{background:"#126f9e",color:"#fff",borderColor:"rgba(192, 192, 192,.5)"},width:"60%","search-input-placeholder":N.searchPlaceholde,"is-show":N.isShow,"data-source":N.dataSource,title:"选择数据","is-show-search-input":"",loading:(0,l.SU)(n.V),onCloseDialog:a[0]||(a[0]=e=>N.isShow=!1),onDoDialogSearch:N.doSearch,onChooseRow:N.chooseRow,onSubmit:N.submit},null,8,["need-selection","use-choose","append-table-style","search-input-placeholder","is-show","data-source","loading","onDoDialogSearch","onChooseRow","onSubmit"])):(0,o.kq)("",!0)])}}};var m=(0,t(40089).Z)(a,[["__scopeId","data-v-3dc9dff2"]])}}]);