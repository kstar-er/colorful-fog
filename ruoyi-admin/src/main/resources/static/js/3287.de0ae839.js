"use strict";(self.webpackChunksystem=self.webpackChunksystem||[]).push([[3287,6228],{51881:function(e,a){a.Z={name:"",key:"",policy:"eyJleHBpcmF0aW9uIjoiMzAyMi0wMS0wMVQxMjowMDowMC4wMDBaIiwiY29uZGl0aW9ucyI6W1siY29udGVudC1sZW5ndGgtcmFuZ2UiLDAsMTA0ODU3NjAwMF1dfQ==",OSSAccessKeyId:"LTAI5t7u1jzmji9stQ5LzCpe",success_action_status:"200",signature:"tF/dwb/qvoQjHffu0kq5FWQq9KY="}},96228:function(e,a,t){t.r(a),t.d(a,{default:function(){return m}});var l=t(73396),o=t(87139),d=t(44870);const n={key:0},s={class:"jx-dialog-header"},i=["id"],r={class:"mb8"},u={style:{width:"100%",border:"1px solid #dcdfe6",padding:"10px"}},c={class:"mt10"};a={__name:"dataLimits",props:{isShow:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},title:{type:String,default:""},width:{type:String,default:"50%"},formEl:{type:Object,default:()=>({})},formData:{type:Object,default:()=>({})},selectTreeNode:{type:Object,default:()=>[]},defaultExpandedKeys:{type:Object,default:()=>[]}},emits:["closeDialog","inputDone","emitOpenDialog"],setup(e,{expose:a,emit:t}){const m=e,p=(0,l.FN)()["proxy"];let f=(0,d.iH)({});const g=()=>{f.value={},t("closeDialog")},h=(0,l.Fl)({get(){return m.isShow&&0!==Object.values(m.formData).length&&Object.assign(f.value,m.formData),m.isShow||w(),m.isShow},set(){}}),y=async()=>{await p.$refs.ruleFormRef.validate(((e,a)=>{e&&((e=p.$refs.dataTreeRef?.getCheckedKeys())&&(f.value.deptIds=e),t("inputDone",JSON.parse(JSON.stringify(f.value))))}))},w=()=>{f.value={},p.$refs.ruleFormRef.resetFields()},v=(0,d.iH)(!1),b=(0,d.qj)({label:"label",children:"children"}),k=e=>{e?p.$refs.dataTreeRef?.setCheckedKeys(m.selectTreeNode.map((e=>e.id))):p.$refs.dataTreeRef?.setCheckedKeys([])};return a({updateDialogInput:e=>{Object.keys(e).forEach((a=>{f.value[a]=e[a]}))},successSubmit:w}),(a,m)=>{const p=(0,l.up)("el-button"),w=(0,l.up)("Edit"),S=(0,l.up)("el-icon"),D=(0,l.up)("el-input"),x=(0,l.up)("el-option"),_=(0,l.up)("el-select"),U=(0,l.up)("el-form-item"),C=(0,l.up)("el-checkbox"),T=(0,l.up)("el-tree"),E=(0,l.up)("el-form");var I=(0,l.up)("el-dialog");return e.isShow?((0,l.wg)(),(0,l.iD)("div",n,[(0,l.Wm)(I,{modelValue:h.value,"onUpdate:modelValue":m[1]||(m[1]=e=>h.value=e),title:"编辑数据权限",top:"4%","close-on-click-modal":!1,"show-close":!1,width:e.width,"lock-scroll":""},{header:(0,l.w5)((({titleId:e,titleClass:t})=>[(0,l._)("div",s,[(0,l._)("h4",{id:e,class:(0,o.C_)(t)},[(0,l.Uk)(" 编辑数据权限 "),(0,l.WI)(a.$slots,"customOperation")],10,i),(0,l.Wm)(p,{class:"dialog-close-btn",type:"danger",icon:"CloseBold",circle:"",onClick:g})])])),default:(0,l.w5)((()=>[(0,l._)("div",null,[(0,l.Wm)(E,{ref:"ruleFormRef",autocomplete:"off",model:(0,d.SU)(f),"label-width":"150px",inline:!0,"scroll-to-error":""},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.formEl,(e=>((0,l.wg)(),(0,l.j4)(U,{key:e.key,label:e.title,rules:e.rules,prop:e.key,class:"mr10"},{default:(0,l.w5)((()=>["input"===e.element?((0,l.wg)(),(0,l.j4)(D,{key:0,modelValue:(0,d.SU)(f)[e.key],"onUpdate:modelValue":a=>(0,d.SU)(f)[e.key]=a,clearable:"",type:e.type,style:{width:"220px"},placeholder:"请输入"+e.title,disabled:"dialog"===e.type||e.disabled,autosize:{minRows:1,maxRows:4},"show-password":"password"===e.type,autocomplete:"new-password"},(0,l.Nv)({_:2},["dialog"===e.type?{name:"append",fn:(0,l.w5)((()=>[(0,l.Wm)(p,{onClick:a=>{return l=e.key,t("emitOpenDialog",l);var l}},{default:(0,l.w5)((()=>[(0,l.Wm)(S,null,{default:(0,l.w5)((()=>[(0,l.Wm)(w)])),_:1})])),_:2},1032,["onClick"])])),key:"0"}:void 0]),1032,["modelValue","onUpdate:modelValue","type","placeholder","disabled","show-password"])):(0,l.kq)("",!0),"select"===e.element?((0,l.wg)(),(0,l.j4)(_,{key:1,modelValue:(0,d.SU)(f)[e.key],"onUpdate:modelValue":a=>(0,d.SU)(f)[e.key]=a,style:{width:"220px"},disabled:e.disabled,placeholder:"请选择"+e.title,multiple:"multiple"===e.type,"collapse-tags":"","collapse-tags-tooltip":"",onChange:e.change},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.options,(e=>((0,l.wg)(),(0,l.j4)(x,{key:e.label,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","disabled","placeholder","multiple","onChange"])):(0,l.kq)("",!0)])),_:2},1032,["label","rules","prop"])))),128)),(0,d.SU)(f)&&"2"===(0,d.SU)(f).dataScope?((0,l.wg)(),(0,l.j4)(U,{key:0,"m-item":"",label:"自定义数据权限",prop:(0,d.SU)(f).menuIds,class:"mr10",style:{width:"90%"}},{default:(0,l.w5)((()=>[(0,l._)("div",r,[(0,l.Wm)(C,{modelValue:v.value,"onUpdate:modelValue":m[0]||(m[0]=e=>v.value=e),label:"全选 / 全不选",onChange:k},null,8,["modelValue"])]),(0,l._)("div",u,[(0,l.Wm)(T,{ref:"dataTreeRef","node-key":"id","default-checked-keys":e.defaultExpandedKeys,props:b,data:e.selectTreeNode,"default-expanded-keys":e.defaultExpandedKeys,"show-checkbox":""},null,8,["default-checked-keys","props","data","default-expanded-keys"])])])),_:1},8,["prop"])):(0,l.kq)("",!0)])),_:1},8,["model"])]),(0,l._)("div",c,[(0,l.Wm)(p,{loading:e.loading,type:"primary",style:{float:"right","margin-right":"10px"},onClick:y},{default:(0,l.w5)((()=>[(0,l.Uk)(" 确定 ")])),_:1},8,["loading"]),(0,l.Wm)(p,{type:"danger",style:{float:"right","margin-right":"10px"},onClick:g},{default:(0,l.w5)((()=>[(0,l.Uk)(" 取消 ")])),_:1})])])),_:3},8,["modelValue","width"])])):(0,l.kq)("",!0)}}};var m=(0,t(40089).Z)(a,[["__scopeId","data-v-0e3fb5e8"]])},34485:function(e,a,t){t.r(a),t.d(a,{default:function(){return b}});var l=t(73396),o=t(44870),d=t(87139),n=t(44385),s=t(96228),i=t(6094),r=t(94666),u=t(12862),c=t(81081);class m extends t(20566).Z{constructor({modules:e="",selectUri:a="/",deleteUri:t="/",selectOneUri:l="/",pageSize:o=20,tableHeader:d}={}){super({modules:e,selectUri:a,deleteUri:t,selectOneUri:l,pageSize:o,tableHeader:d})}forMatData(e,a){if("dataScope"===e)switch(a){case"1":return"所有数据范围";case"2":return"自定义数据权限";case"3":return"本部门数据权限";case"4":return"本部门及以下数据权限";case"5":return"仅本人数据权限";default:return""}return a&&0<a.toString().length||"number"==typeof a?a:"-"}async addRole(e){var{code:e,data:a,msg:t}=(await c.K.post("/system/role",e))["data"];return 200===e?{code:e,data:a}:t}async upDateRole(e){var{code:e,data:a,msg:t}=(await c.K.put("/system/role",e))["data"];return 200===e?{code:e,data:a}:t}async deleteRole(e){var{code:e,data:a,msg:t}=(await c.K.delete("/system/role/"+e))["data"];return 200===e?{code:e,data:a}:t}async getRoleMenu(e){var{code:e,data:a,msg:t}=(await c.K.get("/system/menu/roleMenuTreeselect/"+e))["data"];return 200===e?{code:e,data:a}:t}async getRoleInfo(e){var{code:e,data:a,msg:t}=(await c.K.get("/system/role/"+e))["data"];return 200===e?{code:e,data:a}:t}async getDeptTree(e){var{code:e,data:a,msg:t}=(await c.K.get("system/role/deptTree/"+e))["data"];return 200===e?{code:e,data:a}:t}async setDataScope(e){var{code:e,data:a,msg:t}=(await c.K.put("system/role/dataScope",e))["data"];return 200===e?{code:e,data:a}:t}async changeStatus(e){var{code:e,data:a,msg:t}=(await c.K.put("system/role/changeStatus",e))["data"];return 200===e?{code:e,data:a}:t}}var p=t(82261),f=t(78631),g=t(51881);const h={class:"data-filter"},y={class:"extend-handle"},w={class:"extend-handle-left"},v=["id"];a={__name:"roleManagement",setup(e){const a=(0,l.Q2)("authority"),t=(0,o.iH)(g.Z),b=(0,l.FN)()["proxy"],k=(0,o.iH)(!1),S=(0,o.iH)(null),D=()=>{S.value=new m({modules:"role",selectUri:"/system/role/list"}),S.value.initTableHeader(),S.value.initData(this,b.$refs.table)},x=((0,l.wF)((()=>{D()})),(0,o.iH)([])),_=(0,o.iH)([]),U=async()=>{var{data:e,code:a}=await(new b.$DataTool).getMenuSelect();200===a&&(x.value=e,I.value={status:"0",roleSort:S.value.total+1},_.value=[],V.isShow=!0)},C=async({roleId:e})=>{var{data:a,code:t}=await S.value.getRoleMenu(e);200===t&&(_.value=a.checkedKeys,x.value=a.menus,({data:a,code:t}=await S.value.getRoleInfo(e)),200===t)&&(I.value=a,V.isShow=!0)},T=e=>{S.value.search(e,this,b.$refs.table)},E=e=>e.admin?[(0,l.h)("div",{class:"table-handel-div no-options"},"暂无操作")]:[(0,l.h)("div",{class:"table-handel-div"},[(0,l.wy)((0,l.h)(p.ElButton,{class:"hover-animation",onClick:()=>{C(e)},title:"编辑",type:"primary",icon:"Edit",text:!0,style:"padding:0;margin:0;background:transparent"},{default:()=>""}),[[a,"system:role:edit"]]),(0,l.wy)((0,l.h)(p.ElButton,{class:"hover-animation",onClick:()=>{O(e)},title:"数据权限",type:"warning",icon:"EditPen",text:!0,style:"padding:0;margin:0;background:transparent"},{default:()=>""}),[[a,"system:role:edit"]])])],I=(0,o.iH)({}),V=(0,o.qj)({isShow:!1,formInputEl:[{title:"角色名称",key:"roleName",element:"input",rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]},{title:"权限字符",key:"roleKey",element:"input"}],formSelectEl:[{title:"状态",key:"status",element:"radio",options:[{label:"正常",value:"0"},{label:"停用",value:"1"}],rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]}],formTextAreaEl:[{title:"备注",key:"remark",element:"input",type:"textarea"}],formTimeAndNumber:[{title:"显示顺序",key:"roleSort",element:"number"}],emitOpenDialog:e=>{},inputDone:e=>{e.roleId?S.value.upDateRole(e).then((e=>{200===e.code&&(V.isShow=!1,b.$message.success("更新成功"),S.value.initData(this,b.$refs.table))})):(e.dataScope="4",S.value.addRole(e).then((e=>{200===e.code&&(V.isShow=!1,b.$message.success("新增成功"),S.value.initData(this,b.$refs.table))})))}}),W=({forMatValue:e,column:a,rowData:t})=>"status"===a.key?[(0,l.h)(f.OX,{modelValue:!+t.status,onChange:e=>{b.$alert(`是否变更该角色状态，当前： ${e?"停用":"启用"} ，变更为：`+(e?"启用":"停用"),"提示",{type:"error",showCancelButton:!0,cancelButtonText:"再想想",confirmButtonText:"确认",confirmButtonClass:"delete-confirm-btn",callback:a=>{"cancel"!==a&&(t.status=e?"0":"1",S.value.changeStatus(t).then((e=>{200===e.code&&b.$message.success("修改成功"),S.value.initData(this,b.$refs.table)})))}})}})]:e,H=(0,o.qj)({isShow:!1,formEl:[{title:"角色名称",key:"roleName",element:"input",disabled:!0},{title:"权限字符",key:"roleKey",element:"input",disabled:!0},{title:"数据权限范围",key:"dataScope",element:"select",options:[{label:"所有数据范围",value:"1"},{label:"自定义数据权限",value:"2"},{label:"本部门数据权限",value:"3"},{label:"本部门及以下数据权限",value:"4"},{label:"仅本人数据权限",value:"5"}]}],defaultExpandedKeys:[],selectTreeNode:[],emitOpenDialog:e=>{},inputDone:e=>{e.roleId&&(e.deptIds||(e.deptIds=[]),S.value.setDataScope(e).then((e=>{200===e.code&&(H.isShow=!1,b.$message.success("更新成功"),S.value.initData(this,b.$refs.table))})))}}),O=async({roleId:e})=>{var{data:a,code:t}=await S.value.getDeptTree(e);200===t&&(H.defaultExpandedKeys=a.checkedKeys,H.selectTreeNode=a.depts,({data:a,code:t}=await S.value.getRoleInfo(e)),200===t)&&(I.value=a,H.isShow=!0)};return(e,a)=>{const m=(0,l.up)("CircleCloseFilled"),f=(0,l.up)("el-icon");var g=(0,l.up)("el-drawer"),D=(0,l.Q2)("authorityHandle");return(0,l.wg)(),(0,l.iD)("div",null,[(0,l._)("div",h,[(0,l.Wm)(u.Z,{"filter-items":S.value.tableHeader,onSearch:T},null,8,["filter-items"])]),(0,l._)("div",y,[(0,l._)("div",w,[(0,l.wy)(((0,l.wg)(),(0,l.j4)((0,o.SU)(p.ElButton),{class:"handle-btn mr12",color:"#4a78bd",style:{color:"#666"},plain:"",onClick:U},{default:(0,l.w5)((()=>[(0,l.Uk)(" 新增 ")])),_:1})),[[D,"system:role:add"]])])]),(0,l.Wm)(r.Z,{ref:"table","need-end-handle":"","need-check-box":!1,"need-customize-cell-renderer":"","row-key":"roleId","end-handle-width":140,total:S.value.total,"current-page":S.value.currentPage,"page-size":S.value.pageSize,"table-data":S.value.tableData,columns:S.value.tableHeader,loading:(0,o.SU)(c.V)&&!V.isShow&&!H.isShow,"default-end-handle":!1,"customize-end-handle":E,"for-mat-data":S.value.forMatData,"customize-cell-renderer":W,onSelectionChange:a[0]||(a[0]=e=>S.value.selectionChange(e,S.value,(0,o.SU)(b).$refs.table)),onRefresh:a[1]||(a[1]=e=>S.value.initData(S.value,(0,o.SU)(b).$refs.table)),onEditRow:C,onCurrentChange:a[2]||(a[2]=e=>S.value.currentPageChange(e,S.value,(0,o.SU)(b).$refs.table)),onSizeChange:a[3]||(a[3]=e=>S.value.pageSizeChange(e,S.value,(0,o.SU)(b).$refs.table)),onEditTableHeader:a[4]||(a[4]=e=>k.value=!0)},null,8,["total","current-page","page-size","table-data","columns","loading","for-mat-data"]),(0,l.Wm)(g,{modelValue:k.value,"onUpdate:modelValue":a[6]||(a[6]=e=>k.value=e),"show-close":!1},{header:(0,l.w5)((({titleId:e,titleClass:t})=>[(0,l._)("h4",{id:e,class:(0,d.C_)(t)}," 通过拖拽设置您喜欢的表头顺序 ",10,v),(0,l.Wm)((0,o.SU)(p.ElButton),{type:"danger",onClick:a[5]||(a[5]=e=>k.value=!1)},{default:(0,l.w5)((()=>[(0,l.Wm)(f,{class:"el-icon--left"},{default:(0,l.w5)((()=>[(0,l.Wm)(m)])),_:1}),(0,l.Uk)(" 关闭 ")])),_:1})])),default:(0,l.w5)((()=>[(0,l._)("div",null,[(0,l.Wm)(i.Z,{"is-show-edit-table-header":k.value,modules:"role"},null,8,["is-show-edit-table-header"])])])),_:1},8,["modelValue"]),V.isShow?((0,l.wg)(),(0,l.j4)(n.Z,{key:0,ref:"dialogForm",width:"60%","is-limits":"",loading:(0,o.SU)(c.V),"my-client":t.value,"form-data":I.value,"is-show":V.isShow,title:"请填写相关信息","form-input-el":V.formInputEl,"form-select-el":V.formSelectEl,"form-text-area-el":V.formTextAreaEl,"form-upload-el":V.formUploadEl,"form-time-and-number":V.formTimeAndNumber,"select-tree-node":x.value,"default-expanded-keys":_.value,onCloseDialog:a[7]||(a[7]=e=>V.isShow=!1),onEmitOpenDialog:V.emitOpenDialog,onInputDone:V.inputDone},null,8,["loading","my-client","form-data","is-show","form-input-el","form-select-el","form-text-area-el","form-upload-el","form-time-and-number","select-tree-node","default-expanded-keys","onEmitOpenDialog","onInputDone"])):(0,l.kq)("",!0),H.isShow?((0,l.wg)(),(0,l.j4)(s.default,{key:1,ref:"dataLimitForm","form-data":I.value,loading:(0,o.SU)(c.V),"is-show":H.isShow,"form-el":H.formEl,"default-expanded-keys":H.defaultExpandedKeys,"select-tree-node":H.selectTreeNode,onCloseDialog:a[8]||(a[8]=e=>H.isShow=!1),onEmitOpenDialog:H.emitOpenDialog,onInputDone:H.inputDone},null,8,["form-data","loading","is-show","form-el","default-expanded-keys","select-tree-node","onEmitOpenDialog","onInputDone"])):(0,l.kq)("",!0)])}}};var b=(0,t(40089).Z)(a,[["__scopeId","data-v-3d923cd6"]])},6094:function(e,a,t){t.d(a,{Z:function(){return p}}),t(57658);var l=t(73396),o=t(44870),d=t(49242),n=t(87139),s=t(98249),i=t(40130),r=t(46623);const u={class:"container"},c={class:"drag-box"},m={class:"drag-btn"};a={__name:"dynamicHeader",props:{isShowEditTableHeader:{type:Boolean,default:!1},modules:{type:String,default:""},filterList:{type:Array,default:()=>[]}},emits:["updateCompleted"],setup(e,{emit:a}){const t=e,{_state:p,commit:f}=(0,r.oR)(),g=p.data[t.modules].defaultTableHeader,h=(0,o.qj)([]),y=(0,o.iH)(!1),w=((0,l.wF)((()=>{(h.length=0)===t.filterList.length?h.push(...p.data[t.modules].tableHeader):p.data[t.modules].tableHeader.forEach((e=>{t.filterList.includes(e.key)||h.push(e)}))})),e=>{y.value=!1}),v=()=>{i.T.confirm("重置之后保存的数据将会丢失，是否继续？","提示",{confirmButtonText:"继续",cancelButtonText:"取消",type:"warning"}).then((()=>{h.length=0,h.push(...JSON.parse(JSON.stringify(g))),f(t.modules+"/updateTableHeader",h),i.T.alert("修改成功！刷新后生效","提示",{type:"warning",icon:"InfoFilled",confirmButtonText:"立即刷新",callback:e=>{a("updateCompleted"),location.reload()}}),a("updateCompleted")})).catch((()=>{}))},b=()=>{i.T.confirm("确认保存？","提示",{confirmButtonText:"继续",cancelButtonText:"取消",type:"warning"}).then((()=>{0!==t.filterList.length&&p.data[t.modules].tableHeader.forEach((e=>{t.filterList.includes(e.key)&&h.push(e)})),f(t.modules+"/updateTableHeader",h),i.T.alert("设置成功！刷新后生效","提示",{type:"warning",icon:"InfoFilled",confirmButtonText:"立即刷新",callback:e=>{a("updateCompleted"),location.reload()}})})).catch((()=>{}))};return(e,a)=>{const t=(0,l.up)("el-tag"),i=(0,l.up)("el-checkbox");var r=(0,l.up)("el-button");return(0,l.wg)(),(0,l.iD)("div",u,[(0,l._)("div",c,[(0,l.Wm)((0,o.SU)(s.J),{list:h,"chosen-class":"chosen",group:"name","force-fallback":"true",animation:"500","fallback-tolerance":4,onStart:a[0]||(a[0]=e=>y.value=!0),onEnd:w},{default:(0,l.w5)((()=>[(0,l.Wm)(d.W3,null,{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(h,(e=>((0,l.wg)(),(0,l.iD)("div",{key:e.key||e.prop,class:"item"},[(0,l.Wm)(t,{size:"large"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(e.title||e.label),1)])),_:2},1024),(0,l._)("div",null,[(0,l.Wm)(i,{modelValue:e.isFixed,"onUpdate:modelValue":a=>e.isFixed=a,label:"固定在左边",size:"large"},null,8,["modelValue","onUpdate:modelValue"]),(0,l.Wm)(i,{modelValue:e.isShow,"onUpdate:modelValue":a=>e.isShow=a,label:"是否展示",size:"large"},null,8,["modelValue","onUpdate:modelValue"])])])))),128))])),_:1})])),_:1},8,["list"])]),(0,l._)("div",m,[(0,l.Wm)(r,{type:"warning",onClick:v},{default:(0,l.w5)((()=>[(0,l.Uk)(" 重置 ")])),_:1}),(0,l.Wm)(r,{type:"primary",onClick:b},{default:(0,l.w5)((()=>[(0,l.Uk)(" 保存 ")])),_:1})])])}}};var p=(0,t(40089).Z)(a,[["__scopeId","data-v-4c5f22fa"]])}}]);