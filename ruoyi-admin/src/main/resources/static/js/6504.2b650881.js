"use strict";(self.webpackChunksystem=self.webpackChunksystem||[]).push([[6504,9278,566,9653],{20566:function(e,l,t){t(57658),t(21703);var a=t(81081),o=t(82883);t(68521);const r=o.default["_state"];l.Z=class{constructor({modules:e="",selectUri:l="/",deleteUri:t="/",selectOneUri:a="/",pageSize:o=20,tableHeader:r=[]}={}){this.modules=e,this.selectUri=l,this.selectOneUri=a,this.deleteUri=t,this.searchData={},this.currentPage=1,this.pageSize=o,this.total=0,this.tableData=[],this.tableHeader=r,this.selections=[]}async initData(e=this,l){var{data:t,code:o}=(await a.K.post(`${e.selectUri}?pageNum=${e.currentPage}&pageSize=`+e.pageSize,e.searchData))["data"];200===o&&(e.total=t.total,e.tableData.length=0,e.tableData.push(...t.rows),l?.clearSelection())}currentPageChange(e,l=this,t){l.currentPage=e,l.initData(l,t)}pageSizeChange(e,l=this,t){l.currentPage=1,l.pageSize=e,l.initData(l,t)}search(e,l=this,t){l.searchData=e,l.currentPage=1,l.initData(l,t,!0)}async delete(e,l,t=this){var{code:e,message:o}=(await a.K.post(""+t.deleteUri,e))["data"];return 200===e?(t.initData(t,l),e):o}selectionChange(e,l=this){l.selections.length=0,l.selections.push(...e)}initTableHeader(e=this){if(0===e.tableHeader.length){if(0===e.modules.length||!r.data[e.modules])throw new Error("获取store中的表头, 请提供modules名");e.tableHeader.length=0,e.tableHeader.push(...r.data[e.modules].tableHeader.filter((e=>e.isShow)))}}async selectOne(e,l=this){l=(await a.K.post(l.selectOneUri+"?id="+e))["data"]["data"];return l}}},12608:function(e,l,t){t.d(l,{V:function(){return a.V},o:function(){return r}}),t(57658);var a=t(81081),o=(l=t(20566),t(68521));class r extends l.Z{constructor({modules:e="",selectUri:l="/",deleteUri:t="/",selectOneUri:a="/",pageSize:o=20,tableHeader:r}={}){super({modules:e,selectUri:l,deleteUri:t,selectOneUri:a,pageSize:o,tableHeader:r})}async initData(e=this,l){var{data:t,code:o}=(await a.K.post(`${e.selectUri}?currentPage=${e.currentPage}&pageSize=`+e.pageSize,e.searchData))["data"];200===o&&(e.total=t.pageInfo.total,e.tableData.length=0,e.tableData.push(...t.pageInfo.list),l?.clearSelection())}currentPageChange(e,l=this,t){l.currentPage=e,l.initData(l,t)}pageSizeChange(e,l=this,t){l.currentPage=1,l.pageSize=e,l.initData(l,t)}search(e,l=this,t){l.searchData=e,l.currentPage=1,l.initData(l,t,!0)}forMatData(e,l){var t=e=>{var l=(new o.x).timeStamp2Time(Date.parse(new Date)).split("-");e=e.toString().split(".");return Number(l[1])-Math.abs(Number(e[0]))<=0&&(l[0]=l[0]-Math.abs(Number(l[1])-Math.abs(Number(e[0])))),l[0]+"-"+(Number(l[1])-Math.abs(Number(e[0])))+"-"+e[1]};switch(e){case"costTermFormula":var a=(new o.x).timeStamp2Time(Date.parse(new Date)).slice(0,7);return(new o.x).timeStamp2Time(Date.parse(a)+2592e6*l).slice(0,7);case"timeFormulaStart":case"timeFormulaEnd":return t(l);case"collectObject":return"BILL"===l?"汇总原始数据":"二次汇总";case"billType":return"COST"===l?"应收":"应付";default:return e&&l&&(-1!==e.indexOf("Time")||-1!==e.indexOf("Date"))?(new o.x).timeStamp2Time(l,"yyyy-MM-dd hh:mm:ss"):l&&0<l.toString().length||"number"==typeof l?l:"-"}}async addCollent(e){var{code:e,data:l,msg:t}=(await a.K.post("/colorful-fog/collectSchemeMain/add",e))["data"];return 200===e?{data:l,code:e}:t}async updateCollent(e){var{code:e,data:l,msg:t}=(await a.K.post("/colorful-fog/collectSchemeMain/update",e))["data"];return 200===e?{data:l,code:e}:t}async deleteCollent(e){var{code:e,data:l,msg:t}=(await a.K.post("/colorful-fog/collectSchemeMain/delete",e))["data"];return 200===e?{data:l,code:e}:t}async addCollectDetails(e){var{code:e,data:l,msg:t}=(await a.K.post("/colorful-fog/CollectSchemeDetail/addBatch",e))["data"];return 200===e?{data:l,code:e}:t}async updateCollectDetails(e){var{code:e,data:l,msg:t}=(await a.K.post("/colorful-fog/CollectSchemeDetail/update",e))["data"];return 200===e?{data:l,code:e}:t}async deleteCollectDetails(e){var{code:e,data:l,msg:t}=(await a.K.post("/colorful-fog/CollectSchemeDetail/delete",e))["data"];return 200===e?{data:l,code:e}:t}async getMainDetail(e){var{code:e,data:l,msg:t}=(await a.K.post("/colorful-fog/collectSchemeMain/select?currentPage=1&pageSize=1",{id:e}))["data"];return 200===e?{data:l,code:e}:t}async createCollect(e){var{code:e,data:l,msg:t}=(await a.K.post("/colorful-fog/collectSchemeMain/create",e))["data"];return 200===e?{data:l,code:e}:t}async createOneUser(e){var{code:e,data:l,msg:t}=(await a.K.post("/colorful-fog/collectSchemeMain/createOneUser",e))["data"];return 200===e?{data:l,code:e}:t}async createAndExport(e){var{code:e,data:l,msg:t}=(await a.K.post("/colorful-fog/collectSchemeMain/createAndExport",e))["data"];return 200===e?{data:l,code:e}:t}}},81198:function(e,l,t){t.d(l,{B:function(){return o}});var a=t(73396);function o(){const e=(0,a.FN)()["proxy"];return{popup:{handleAlert:(l,t,a,o)=>{a={type:"info",showCancelButton:!0,cancelButtonText:"再想想",confirmButtonText:"确认",callback:e=>{"confirm"===e&&o()},...a},e.$alert(t,l,a)},handlePrompt:(l,t,a,o)=>{a={confirmButtonText:"确定",cancelButtonText:"取消",...a},e.$prompt(t,l,a).then((({value:e})=>{o(e)})).catch((()=>{}))}}}}},79278:function(e,l,t){t.r(l),t.d(l,{default:function(){return w}}),t(57658);var a=t(73396),o=t(87139),r=t(44870);l=e=>((0,a.dD)("data-v-ccf07282"),e=e(),(0,a.Cn)(),e);const s={key:0},i={class:"jx-dialog-header"},c=["id"],u=l((()=>(0,a._)("div",null," 字段名称： ",-1))),d=["onClick"],n={class:"mt10"},m=l((()=>(0,a._)("div",null," 运算规则： ",-1))),p={class:"mt10"},h=l((()=>(0,a._)("div",null," 表达式： ",-1))),g={ref:"expression",class:"expression"},f={key:0,class:"mt10"},y={class:"mt10"};l={__name:"createFun",props:{isShow:{type:Boolean,default:!1},confirmText:{type:String,default:"确定"},list:{type:Object,default:()=>[]},defaultExpresion:{type:String,default:""}},emits:["closeDialog","inputDone","emitOpenDialog"],setup(e,{emit:l}){const t=e;var{}=(0,a.FN)();(0,a.YP)((()=>t.isShow),(()=>{if(t.isShow){C.length=0;var e=t.defaultExpresion;let a=0,o="";var l=[];for(let t=0;t<e.length;)"$"===e[t]?(a=1,t+=2):a&&"}"===e[t]?(l.push(o),o="",e[t+1]&&l.push(e[t+1]),t+=2,a=0):(a?o+=e[t]:l.push(e[t]),t++);l.forEach((e=>{var l;-1==="()+-*/".indexOf(e)?(l=t.list.find((l=>(l?.resultCode??l?.collectResultCode)===e)),C.push({name:l?.resultName??l?.collectResultName,code:l?.resultCode??l?.collectResultCode})):C.push({name:e,type:"danger"})}))}}));const w=()=>{l("closeDialog")},b=()=>{let e="";C.forEach((l=>{l.type?e+=l.name:e+=`\${${l.code}}`})),l("inputDone",e)},C=(0,r.qj)([]),v=(e,l)=>{"danger"===l?C.push({name:e,type:l}):C.push({name:e?.resultName??e?.collectResultName,code:e?.resultCode??e?.collectResultCode})},S=(0,a.Fl)({get(){return t.isShow},set(){}});return(l,t)=>{const r=(0,a.up)("el-button"),D=(0,a.up)("el-tag"),N=(0,a.up)("xButton");var k=(0,a.up)("el-dialog");return e.isShow?((0,a.wg)(),(0,a.iD)("div",s,[(0,a.Wm)(k,{modelValue:S.value,"onUpdate:modelValue":t[6]||(t[6]=e=>S.value=e),top:"4%","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,"lock-scroll":""},{header:(0,a.w5)((({titleId:e,titleClass:t})=>[(0,a._)("div",i,[(0,a._)("h4",{id:e,class:(0,o.C_)(t)},[(0,a.Uk)(" 构造计算表达式 "),(0,a.WI)(l.$slots,"customOperation")],10,c),(0,a.Wm)(r,{class:"dialog-close-btn",type:"danger",icon:"CloseBold",circle:"",plain:"",onClick:w})])])),default:(0,a.w5)((()=>[(0,a._)("div",null,[(0,a._)("div",null,[u,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.list,(e=>((0,a.wg)(),(0,a.iD)("div",{key:e.id,ref_for:!0,ref:"tag"+e.id,class:"mr20 mt10 tag",style:{cursor:"pointer"},onClick:l=>v(e)},(0,o.zw)(e?.resultName??e?.collectResultName),9,d)))),128))]),(0,a._)("div",n,[m,(0,a._)("div",{ref:"add",class:"mr20 mt10 tag",type:"danger","disable-transitions":!1,style:{cursor:"pointer",background:"rgb(252, 156, 172)"},onClick:t[0]||(t[0]=e=>v("(","danger"))}," ( ",512),(0,a._)("div",{ref:"add",class:"mr20 mt10 tag",type:"danger","disable-transitions":!1,style:{cursor:"pointer",background:"rgb(252, 156, 172)"},onClick:t[1]||(t[1]=e=>v(")","danger"))}," ) ",512),(0,a._)("div",{ref:"add",class:"mr20 mt10 tag",type:"danger","disable-transitions":!1,style:{cursor:"pointer",background:"rgb(252, 156, 172)"},onClick:t[2]||(t[2]=e=>v("+","danger"))}," + ",512),(0,a._)("div",{ref:"subtract",class:"mr20 mt10 tag",type:"danger","disable-transitions":!1,style:{cursor:"pointer",background:"rgb(252, 156, 172)"},onClick:t[3]||(t[3]=e=>v("-","danger"))}," - ",512),(0,a._)("div",{ref:"multiply",class:"mr20 mt10 tag",type:"danger","disable-transitions":!1,style:{cursor:"pointer",background:"rgb(252, 156, 172)"},onClick:t[4]||(t[4]=e=>v("*","danger"))}," * ",512),(0,a._)("div",{ref:"divide",class:"mr20 mt10 tag",type:"danger","disable-transitions":!1,style:{cursor:"pointer",background:"rgb(252, 156, 172)"},onClick:t[5]||(t[5]=e=>v("/","danger"))}," / ",512)]),(0,a._)("div",p,[h,(0,a._)("div",g,[0===C.length?((0,a.wg)(),(0,a.iD)("div",f," 暂无公式 ")):(0,a.kq)("",!0),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(C,((e,l)=>((0,a.wg)(),(0,a.j4)(D,{key:e.name,class:"mr6 mt10",closable:"",type:e.type||"primary",style:{cursor:"pointer"},onClose:e=>{var t;t=l,C.splice(t,1)}},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.name),1)])),_:2},1032,["type","onClose"])))),128))],512)])]),(0,a._)("div",y,[(0,a.Wm)(N,{type:"primary",style:{float:"right","margin-right":"10px"},onClick:b},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.confirmText),1)])),_:1}),(0,a.Wm)(N,{type:"danger",style:{float:"right","margin-right":"10px"},onClick:w},{default:(0,a.w5)((()=>[(0,a.Uk)(" 取消 ")])),_:1})])])),_:3},8,["modelValue"])])):(0,a.kq)("",!0)}}};var w=(0,t(40089).Z)(l,[["__scopeId","data-v-ccf07282"]])},32808:function(e,l,t){t.r(l),t.d(l,{default:function(){return _}}),t(57658);var a=t(73396),o=t(87139),r=t(44870),s=t(81081),i=t(88490),c=t(44385),u=t(98249),d=t(79278),n=t(81198),m=t(22483),p=t(12608);l=e=>((0,a.dD)("data-v-0f707f54"),e=e(),(0,a.Cn)(),e);const h={class:"header"},g={class:"route"},f={class:"route",style:{color:"#999"}},y={class:"detail"},w=l((()=>(0,a._)("div",{class:"card-header"}," 基本信息 ",-1))),b={style:{display:"flex","align-items":"center"},class:"mb10"},C={style:{display:"flex"}},v={style:{width:"120px"},class:"mt10"},S={class:"collect"},D={class:"detail"},N={class:"card-header"},k={class:"inline-block mr20 flex-center"},T=l((()=>(0,a._)("span",{class:"ml6"}," 汇总的账单： ",-1))),U={class:"inline-block mr20 flex-center"},F=l((()=>(0,a._)("span",{class:"ml6"}," 时间限制字段： ",-1))),E={key:0};l={__name:"collectDetail",setup(e){const l=(0,a.FN)()["proxy"],t=(0,n.B)()["popup"],_=(0,m.tv)(),R=(0,m.yj)(),O=(0,r.iH)("首页 / 汇总计划明细 / "),x=(0,r.iH)(""+R.query.title),I=()=>{_.go(-1)},B=(0,r.iH)(null),W=(0,r.iH)(!1),q=[],M=e=>{let{newIndex:l,oldIndex:t}=e;if(l!==t){t<l&&([l,t]=[t,l]);for(let e=l;e<=t;e++)he.value[e].displayOrder=e+1;q.splice(0,q.length,...he.value.slice(l,t+1)),q.forEach((e=>{B.value.tableData.forEach((l=>{l.collectResultCode===e.collectResultCode&&(l.displayOrder=e.displayOrder,q.push(l))}))}))}},P=()=>{t.handleAlert("提示","是否保存当前的展示顺序",{},(()=>{B.value.updateCollectDetails(q).then((e=>{200===e.code&&(l.$message.success("保存成功！"),$(),W.value=!1)}))}))},z=()=>{t.handleAlert("提示","是否取消修改",{},(()=>{$(),W.value=!1}))},$=async()=>{await B.value.initData(this,l.$refs.table);let e=[],t={};ge(B.value.tableData),B.value.tableData.forEach(((l,a)=>{l.schemeCode&&(t.hasOwnProperty(l.schemeCode)?e[t[l.schemeCode]].schemeDetailList.push({schemeCode:l.schemeCode,collectResultCode:l.collectResultCode,collectResultName:l.collectResultName,schemeResultCode:l.schemeResultCode,schemeResultName:l.schemeResultName,collectType:l.collectType,id:l.id,hideWhenPush:l.hideWhenPush,groupByFieldName:l.groupByFieldName,groupByFieldValue:l.groupByFieldValue,groupByField:l.groupByField,decimal:l.decimal}):(t[l.schemeCode]=e.length,e.push({schemeName:l.schemeName,schemeCode:l.schemeCode,timeFieldName:l.timeFieldName,timeField:l.timeField,schemeDetailList:[{schemeCode:l.schemeCode,collectResultCode:l.collectResultCode,collectResultName:l.collectResultName,schemeResultCode:l.schemeResultCode,schemeResultName:l.schemeResultName,collectType:l.collectType,id:l.id,hideWhenPush:l.hideWhenPush,groupByFieldName:l.groupByFieldName,groupByFieldValue:l.groupByFieldValue,groupByField:l.groupByField,decimal:l.decimal}]})))})),H.length=0,H.push(...e)},j=(0,r.iH)(null);let A=e=>{var t=(new l.$DataTool).timeStamp2Time(Date.parse(new Date)).split("-");e=e.toString().split(".");return Number(t[1])-Math.abs(Number(e[0]))<=0&&(t[0]=t[0]-Math.abs(Number(t[1])-Math.abs(Number(e[0])))),t[0]+"-"+(Number(t[1])-Math.abs(Number(e[0]))).toString().padStart(2,"0")+"-"+e[1].toString().padStart(2,"0")};(0,a.wF)((()=>{B.value=new p.o({modules:"summaryPlan",selectUri:"/colorful-fog/CollectSchemeDetail/select",pageSize:2e3}),B.value.getMainDetail(R.query.id).then((e=>{200===e.code&&(j.value=e.data.pageInfo.list[0],j.value.timeFormula=[A(j.value.timeFormulaStart),A(j.value.timeFormulaEnd)])})),B.value.searchData={collectSchemeCode:R.query.collectSchemeCode},$()}));const L={SUM:{color:"warning",state:!1,style:"",action:!1},ONE:{color:"warning",state:!1,style:"",action:!1},CONDITION_SUM:{color:"warning",state:!1,style:"",action:!1},EQUATION:{color:"danger",state:!0,style:"cursor:pointer",action:!0},EMPTY:{color:"primary",state:!0,style:"cursor:pointer",action:!0}},H=(0,r.qj)([]),V=()=>{K.value={},Y.isShow=!0},K=(0,r.iH)({}),Y=(0,r.qj)({isShow:!1,formInputEl:[{title:"汇总的账单",key:"schemeName",element:"input",type:"dialog",rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]},{title:"时间限制字段",key:"timeFieldName",element:"input",type:"dialog",rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]}],formSelectEl:[],formTextAreaEl:[],formTimeAndNumber:[],emitOpenDialog:e=>{ce(e)},inputDone:e=>{-1!==H.findIndex((l=>l.schemeCode===e.schemeCode))?l.$message.error("该账单方案已经添加过了"):(H.push({schemeCode:e.schemeCode,schemeName:e.schemeName,collectType:e.collectType,timeFieldName:e.timeFieldName,timeField:e.timeField,schemeDetailList:[]}),Y.isShow=!1)}}),Q=(0,r.iH)({}),Z=e=>{"CONDITION_SUM"===e?"需限制条件的字段"!==G.formInputEl[2].title&&(G.formInputEl.splice(2,0,{title:"需限制条件的字段",key:"groupByFieldName",element:"input",type:"dialog",rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]}),G.formInputEl.splice(3,0,{title:"条件限制值",key:"groupByFieldValue",element:"input",rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]})):"需限制条件的字段"===G.formInputEl[2].title&&G.formInputEl.splice(2,2)},G=(0,r.qj)({isShow:!1,formInputEl:[{title:"原账单字段",key:"schemeResultName",element:"input",type:"dialog",rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]},{title:"汇总后字段名称",key:"collectResultName",element:"input",rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]},{title:"小数点位数",key:"decimal",element:"input"},{title:"字段类型",key:"collectType",element:"radio",options:[{label:"所有相关字段相加",value:"SUM"},{label:"条件汇总",value:"CONDITION_SUM"},{label:"只取一行中的数据",value:"ONE"}],rules:[{required:!0,message:"该项不能为空",trigger:"blur"}],change:e=>{Z(e)}},{title:"推送时隐藏",key:"hideWhenPush",element:"radio",options:[{label:"是",value:!0},{label:"否",value:!1}],rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]}],formSelectEl:[],formTextAreaEl:[],formTimeAndNumber:[],emitOpenDialog:e=>{ce(e,G.append)},inputDone:e=>{var t="SUM"===e.collectType||"CONDITION_SUM"===e.collectType?"NUMBER":e.parentType,a=(t={collectSchemeCode:R.query.collectSchemeCode,schemeCode:G.append.schemeCode,schemeName:G.append.schemeName,timeFieldName:G.append.timeFieldName,timeField:G.append.timeField,collectType:e.collectType,collectResultName:e.collectResultName,schemeResultCode:e.schemeResultCode,schemeResultName:e.schemeResultName,hideWhenPush:e.hideWhenPush,groupByFieldName:e.groupByFieldName,groupByFieldValue:e.groupByFieldValue,groupByField:e.groupByField,decimal:e.decimal,resultType:t},ee(t));e.id?(t.id=e.id,t.collectResultCode=(a||e).collectResultCode,B.value.updateCollectDetails([t]).then((e=>{200===e.code&&(l.$message.success("更新成功"),$())}))):(a&&(t.collectResultCode=a.collectResultCode),B.value.addCollectDetails([t]).then((e=>{200===e.code&&(l.$message.success("新增成功"),$())}))),G.isShow=!1}}),J=(0,r.qj)({isShow:!1,formInputEl:[{title:"汇总后字段名称",key:"collectResultName",element:"input",rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]},{title:"字段类型",key:"collectType",element:"radio",options:[{label:"公式",value:"EQUATION"}],rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]},{title:"推送时隐藏",key:"hideWhenPush",element:"radio",options:[{label:"是",value:!0},{label:"否",value:!1}],rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]}],formSelectEl:[{title:"结果类型",key:"resultType",element:"select",options:[{label:"数字",value:"NUMBER"},{label:"字符串",value:"STRING"},{label:"日期",value:"DATE"},{label:"链接",value:"URL"}],rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]}],formTextAreaEl:[],formTimeAndNumber:[{title:"显示顺序",key:"displayOrder",element:"number"}],inputDone:e=>{var t={collectSchemeCode:R.query.collectSchemeCode,displayOrder:e.displayOrder,collectType:e.collectType,collectResultName:e.collectResultName,id:e.id,resultType:e.resultType,hideWhenPush:e.hideWhenPush};e.expression&&(t.expression=e.expression),e.id?B.value.updateCollectDetails([t]).then((e=>{200===e.code&&(l.$message.success("修改成功"),$(),J.isShow=!1)})):X(t)?l.$message.error("字段名称重复"):B.value.addCollectDetails([t]).then((e=>{200===e.code&&(l.$message.success("新增成功"),$(),J.isShow=!1)}))}}),X=e=>he.value.find((l=>l.collectResultName===e.collectResultName)),ee=e=>B.value.tableData.find((l=>l.collectResultName===e.collectResultName)),le=(0,r.iH)(null),te=e=>{l.$refs.dialogFormula.updateDialogInput({expression:e}),re.value.expression=e,ae.value=!1},ae=(0,r.iH)(!1),oe=()=>{ae.value=!0},re=(0,r.iH)({}),se=e=>{switch(l.$refs?.dialogFormula?.clearInput(),e){case"EQUATION":J.formInputEl=[{title:"汇总后字段名称",key:"collectResultName",element:"input",rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]},{title:"字段类型",key:"collectType",element:"radio",options:[{label:"公式",value:"EQUATION"}],rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]},{title:"推送时隐藏",key:"hideWhenPush",element:"radio",options:[{label:"是",value:!0},{label:"否",value:!1}],rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]}];break;case"EMPTY":J.formInputEl=[{title:"汇总后字段名称",key:"collectResultName",element:"input",rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]},{title:"字段类型",key:"collectType",element:"radio",options:[{label:"空白",value:"EMPTY"}],rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]}];break;default:return}},ie=e=>{se(e),re.value={hideWhenPush:!1,collectType:e,displayOrder:he.value.length+1,resultType:"NUMBER"},J.isShow=!0},ce=async(e,t)=>{switch(ne.useChoose=!0,e){case"schemeName":return ne.searchPlaceholde="输入账单计划名称进行搜索",ne.chooseRow=e=>{e.children||("COLLECT"!==R.query.collectObject?(K.value.schemeCode=e.schemeCode,l.$refs.dialogForm.updateDialogInput({schemeName:e.name,schemeCode:e.schemeCode})):(K.value.collectSchemeCode=e.collectSchemeCode,l.$refs.dialogForm.updateDialogInput({schemeName:e.collectSchemeName,schemeCode:e.collectSchemeCode})),l.$refs.dialogForm.updateDialogInput({timeFieldName:null,timeField:null}),ne.isShow=!1)},ne.doSearch=e=>{ne.dataSource.searchData={},e&&(ne.dataSource.searchData.name=e),ne.dataSource.initData()},ne.dataSource=new p.o({selectUri:"COLLECT"===R.query.collectObject?"/colorful-fog/collectSchemeMain/select":"/colorful-fog/schemeMain/selectMenu",tableHeader:"COLLECT"===R.query.collectObject?[{label:"账单名称",prop:"collectSchemeName",width:200},{label:"账单code",prop:"collectSchemeCode",width:200},{label:"账单描述",prop:"collectSchemeDesc",width:200}]:[{label:"账单名称",prop:"name",width:200},{label:"账单code",prop:"schemeCode",width:200},{label:"类型",prop:"billType",width:200}],pageSize:10}),ne.dataSource.forMatData=(e,l)=>e[l.property]?"billType"===l.property?"PAY"===e[l.property]?"应付":"应收":e[l.property]??"-":"-","COLLECT"!==R.query.collectObject&&(ne.dataSource.initData=async(e=ne.dataSource)=>{var{data:e,code:l}=(await s.K.post(`${e.selectUri}?currentPage=${e.currentPage}&pageSize=`+e.pageSize,e.searchData))["data"];200===l&&(ne.dataSource.tableData.length=0,l=Object.entries(e).reduce(((e,l,t)=>(l={name:l[0],children:l[1],id:t+1,schemeCode:"-"},e.push(l),e)),[]),ne.dataSource.tableData.push(...l),ne.dataSource.total=ne.dataSource.tableData.length)}),await ne.dataSource.initData(),void(ne.isShow=!0);case"groupByFieldName":case"timeFieldName":case"schemeResultName":return ne.useChoose=!1,ne.searchPlaceholde="输入字段名称进行搜索",ne.chooseRow=t=>{"COLLECT"===R.query.collectObject?("schemeResultName"===e&&l.$refs.dialogFormFiled.updateDialogInput({schemeResultName:t.collectResultName,schemeResultCode:t.collectResultCode,collectResultName:t.collectResultName}),"timeFieldName"===e&&l.$refs.dialogForm.updateDialogInput({timeFieldName:t.collectResultName,timeField:t.collectResultCode}),"groupByFieldName"===e&&l.$refs.dialogFormFiled.updateDialogInput({groupByFieldName:t.collectResultName,groupByField:t.collectResultCode})):("schemeResultName"===e&&l.$refs.dialogFormFiled.updateDialogInput({schemeResultName:t.resultName,schemeResultCode:t.resultCode,collectResultName:t.resultName,decimal:t.decimal,parentType:t.resultType}),"timeFieldName"===e&&l.$refs.dialogForm.updateDialogInput({timeFieldName:t.resultName,timeField:t.resultCode}),"groupByFieldName"===e&&l.$refs.dialogFormFiled.updateDialogInput({groupByFieldName:t.resultName,groupByField:t.resultCode})),ne.isShow=!1},ne.doSearch=e=>{"COLLECT"===R.query.collectObject?ne.dataSource.searchData={collectSchemeCode:t?t.schemeCode:K.value.collectSchemeCode}:ne.dataSource.searchData={schemeCode:(t||K.value).schemeCode},e&&(ne.dataSource.searchData.resultName=e),ne.dataSource.initData()},ne.dataSource=new p.o({selectUri:"COLLECT"===R.query.collectObject?"/colorful-fog/CollectSchemeDetail/select":"/colorful-fog/schemeDetail/select",tableHeader:"COLLECT"===R.query.collectObject?[{label:"字段名称",prop:"collectResultName",width:200},{label:"字段Code",prop:"collectResultCode",width:200},{label:"字段类型",prop:"collectType",width:200}]:[{label:"字段名称",prop:"resultName",width:200},{label:"字段Code",prop:"resultCode",width:200},{label:"字段类型",prop:"type",width:200}],pageSize:10}),"COLLECT"===R.query.collectObject?ne.dataSource.searchData={collectSchemeCode:t?t.schemeCode:K.value.collectSchemeCode}:ne.dataSource.searchData={schemeCode:(t||K.value).schemeCode},ne.dataSource.forMatData=(e,l)=>"type"===l.property?ue[e[l.property]]:"collectType"===l.property?de[e[l.property]]:e[l.property]??"-",await ne.dataSource.initData(),void(ne.isShow=!0)}},ue={FIXED:"固定系数",ORDER_DATA:"原单据字段值",DEPEND:"分类系数",EQUATION:"自定义公式"},de={SUM:"所有相关字段相加",ONE:"只取一行中的数据"},ne=(0,r.qj)({isShow:!1,dataSource:null,searchPlaceholde:"",doSearch:e=>{},chooseRow:e=>{}}),me=(e,t,a)=>{var o=e["collectType"];o=!e.id&&("EQUATION"===o?t:t.schemeDetailList);o&&o.splice(a,1),1===t?.schemeDetailList?.length?l.$alert("已经是最后一个字段了，确认删除请点继续！","提示",{type:"error",icon:"InfoFilled",confirmButtonText:"继续",callback:t=>{"confirm"===t&&B.value.deleteCollectDetails([e.id]).then((e=>{200===e.code&&(l.$message.success("删除成功"),$())}))}}):l.$alert("是否确认删除当前字段？","提示",{type:"error",icon:"InfoFilled",confirmButtonText:"确定",callback:t=>{"confirm"===t&&B.value.deleteCollectDetails([e.id]).then((e=>{200===e.code&&(l.$message.success("删除成功"),$())}))}})},pe=(e,l,t)=>{"EQUATION"===e.collectType||"EMPTY"===e.collectType?(se(e.collectType),re.value={...e},J.append=e,J.index=l,J.isShow=!0):(Q.value={...e},"CONDITION_SUM"===e.collectType?"需限制条件的字段"!==G.formInputEl[2].title&&(G.formInputEl.splice(2,0,{title:"需限制条件的字段",key:"groupByFieldName",element:"input",type:"dialog",rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]}),G.formInputEl.splice(3,0,{title:"条件限制值",key:"groupByFieldValue",element:"input",rules:[{required:!0,message:"该项不能为空",trigger:"blur"}]})):"需限制条件的字段"===G.formInputEl[2].title&&G.formInputEl.splice(2,2),G.append=e,G.index=l,G.isShow=!0)},he=(0,r.iH)([]),ge=e=>(he.value=e.filter(((l,t)=>e.findIndex((e=>e.collectResultName===l.collectResultName))===t)),he.value.sort(((e,l)=>e.displayOrder-l.displayOrder)),he.value);return(e,l)=>{const t=(0,a.up)("el-button");var s=(0,a.up)("el-page-header");const n=(0,a.up)("el-tag"),m=(0,a.up)("Warning"),_=(0,a.up)("el-icon"),R=(0,a.up)("el-popover"),B=(0,a.up)("el-dropdown-item"),q=(0,a.up)("el-dropdown-menu"),$=(0,a.up)("el-dropdown"),A=(0,a.up)("el-card"),X=(0,a.up)("el-input"),ee=(0,a.up)("el-form-item"),se=(0,a.up)("xButton");var ce=(0,a.Q2)("loading");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("div",h,[(0,a.Wm)(s,{onBack:I},{content:(0,a.w5)((()=>[(0,a._)("span",g,(0,o.zw)(O.value),1),(0,a._)("span",f,(0,o.zw)(x.value),1),(0,a.Wm)(t,{type:"primary",class:"ml20",size:"small",onClick:V},{default:(0,a.w5)((()=>[(0,a.Uk)(" 新增汇总 ")])),_:1})])),_:1})]),(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",y,[(0,a.Wm)(A,{class:"box-card",shadow:"hover"},{header:(0,a.w5)((()=>[w])),default:(0,a.w5)((()=>[(0,a._)("div",b,[(0,a.Uk)(" 汇总计划名称： "),(0,a.Wm)(n,{type:"info",class:"ml10 mr20"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(j.value?.collectSchemeName),1)])),_:1}),(0,a.Uk)(" 汇总计划描述： "),(0,a.Wm)(n,{type:"info",class:"ml10 mr20"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(j.value?.collectSchemeDesc),1)])),_:1}),(0,a.Uk)(" 汇总日期： "),(0,a.Wm)(n,{type:"info",class:"ml10 mr20"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(j.value?.timeFormula?.join(" 至 ")),1)])),_:1}),(0,a.Uk)(" 汇总类型： "),(0,a.Wm)(n,{type:"info",class:"ml10 mr20"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)("BILL"===j.value?.collectObject?"汇总原始账单":"二次汇总"),1)])),_:1}),(0,a.Uk)(" 账单类型： "),(0,a.Wm)(n,{type:"info"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)("COST"===j.value?.billType?"应收":"应付"),1)])),_:1})]),(0,a._)("div",C,[(0,a._)("div",v,[(0,a.Wm)(R,{placement:"top",width:"300",effect:"dark","hide-after":0},{reference:(0,a.w5)((()=>[(0,a.Wm)(_,{style:{color:"rgb(255, 0, 0)"}},{default:(0,a.w5)((()=>[(0,a.Wm)(m)])),_:1})])),default:(0,a.w5)((()=>[(0,a.Uk)(" 相同字段已合并 ")])),_:1}),(0,a.Uk)(" 汇总的字段： ")]),(0,a._)("div",S,[(0,a.Wm)((0,r.SU)(u.J),{list:he.value,"chosen-class":"chosen",group:"collect","force-fallback":"true",animation:"500",filter:".unmover","fallback-tolerance":4,onStart:l[0]||(l[0]=e=>W.value=!0),onEnd:M},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(he.value,(l=>((0,a.wg)(),(0,a.j4)(n,{key:l.id,type:L[l?.collectType].color,closable:L[l?.collectType].state,style:(0,o.j5)(L[l?.collectType].style),class:"mr10 mt10",onClose:t=>me(l,he.value,e.index),onClick:e=>L[l?.collectType].action?pe(l,he.value):null},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(l?.collectResultName),1)])),_:2},1032,["type","closable","style","onClose","onClick"])))),128)),W.value?((0,a.wg)(),(0,a.j4)(t,{key:0,type:"primary",style:{"margin-top":"6px"},text:"",class:"unmover",onClick:P},{default:(0,a.w5)((()=>[(0,a.Uk)(" 保存当前顺序 ")])),_:1})):(0,a.kq)("",!0),W.value?((0,a.wg)(),(0,a.j4)(t,{key:1,type:"primary",style:{"margin-top":"6px"},class:"unmover",text:"",onClick:z},{default:(0,a.w5)((()=>[(0,a.Uk)(" 取消修改 ")])),_:1})):(0,a.kq)("",!0)])),_:1},8,["list","filter"]),(0,a.Wm)($,{trigger:"click",class:"ml10",style:{"margin-top":"6px"},onCommand:ie},{dropdown:(0,a.w5)((()=>[(0,a.Wm)(q,null,{default:(0,a.w5)((()=>[(0,a.Wm)(B,{command:"EQUATION"},{default:(0,a.w5)((()=>[(0,a.Uk)(" 公式 ")])),_:1}),(0,a.Wm)(B,{command:"EMPTY",divided:""},{default:(0,a.w5)((()=>[(0,a.Uk)(" 空白 ")])),_:1})])),_:1})])),default:(0,a.w5)((()=>[(0,a.Wm)(t,{type:"primary",text:""},{default:(0,a.w5)((()=>[(0,a.Uk)(" + 新增字段 ")])),_:1})])),_:1})])])])),_:1})])),[[ce,(0,r.SU)(p.V)&&!Y.isShow&&!G.isShow&&!ne.isShow]]),(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",D,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(H,((e,l)=>((0,a.wg)(),(0,a.j4)(A,{key:e.schemeCode,class:"mb30",shadow:"hover"},{header:(0,a.w5)((()=>[(0,a._)("div",N,[(0,a._)("div",k,[(0,a.Wm)(R,{placement:"top",width:"300",effect:"dark","hide-after":0},{reference:(0,a.w5)((()=>[(0,a.Wm)(_,{style:{color:"rgb(255, 0, 0)"}},{default:(0,a.w5)((()=>[(0,a.Wm)(m)])),_:1})])),default:(0,a.w5)((()=>[(0,a.Uk)(" 哪个方案生成的账单数据需要汇总 ")])),_:1}),T,(0,a.Wm)(n,{type:"success"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.schemeName),1)])),_:2},1024)]),(0,a._)("div",U,[(0,a.Wm)(R,{placement:"top",width:"300",effect:"dark","hide-after":0},{reference:(0,a.w5)((()=>[(0,a.Wm)(_,{style:{color:"rgb(255, 0, 0)"}},{default:(0,a.w5)((()=>[(0,a.Wm)(m)])),_:1})])),default:(0,a.w5)((()=>[(0,a.Uk)(" 哪个时间段的账单需要汇总，这个时间段去哪个数据的值 ")])),_:1}),F,(0,a.Wm)(n,{type:"success"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.timeFieldName),1)])),_:2},1024)])])])),default:(0,a.w5)((()=>[(0,a._)("div",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.schemeDetailList,((t,r)=>((0,a.wg)(),(0,a.j4)(n,{key:t.id,class:"mr20 mb10",closable:"",size:"large","disable-transitions":!1,style:{cursor:"pointer"},onClose:l=>me(t,e,r),onClick:e=>pe(t,l)},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(t.schemeResultName)+" 汇总成--\x3e "+(0,o.zw)(t.collectResultName),1)])),_:2},1032,["onClose","onClick"])))),128)),(0,a.Wm)(t,{type:"primary",class:"mb10",text:"",onClick:t=>{return a=e,o=l,G.isShow=!0,G.append=a,G.index=o,Z("SUM"),void(Q.value={hideWhenPush:!1,collectType:"SUM"});var a,o}},{default:(0,a.w5)((()=>[(0,a.Uk)(" + 新增字段 ")])),_:2},1032,["onClick"])])])),_:2},1024)))),128))])),[[ce,(0,r.SU)(p.V)&&!Y.isShow&&!G.isShow&&!ne.isShow]]),Y.isShow?((0,a.wg)(),(0,a.j4)(c.Z,{key:0,ref:"dialogForm",width:"42%",loading:(0,r.SU)(p.V),"form-data":K.value,"is-show":Y.isShow,title:"请填写相关信息","form-input-el":Y.formInputEl,"form-select-el":Y.formSelectEl,"form-text-area-el":Y.formTextAreaEl,"form-upload-el":Y.formUploadEl,"form-time-and-number":Y.formTimeAndNumber,onCloseDialog:l[1]||(l[1]=e=>Y.isShow=!1),onEmitOpenDialog:Y.emitOpenDialog,onInputDone:Y.inputDone},null,8,["loading","form-data","is-show","form-input-el","form-select-el","form-text-area-el","form-upload-el","form-time-and-number","onEmitOpenDialog","onInputDone"])):(0,a.kq)("",!0),G.isShow?((0,a.wg)(),(0,a.j4)(c.Z,{key:1,ref:"dialogFormFiled",width:"42%",loading:(0,r.SU)(p.V),"form-data":Q.value,"is-show":G.isShow,title:"请填写相关信息","form-input-el":G.formInputEl,"form-select-el":G.formSelectEl,"form-text-area-el":G.formTextAreaEl,"form-upload-el":G.formUploadEl,"form-time-and-number":G.formTimeAndNumber,onCloseDialog:l[2]||(l[2]=e=>G.isShow=!1),onEmitOpenDialog:G.emitOpenDialog,onInputDone:G.inputDone},null,8,["loading","form-data","is-show","form-input-el","form-select-el","form-text-area-el","form-upload-el","form-time-and-number","onEmitOpenDialog","onInputDone"])):(0,a.kq)("",!0),J.isShow?((0,a.wg)(),(0,a.j4)(c.Z,{key:2,ref_key:"dialogFormula",ref:le,width:"42%",loading:(0,r.SU)(p.V),"form-data":re.value,"is-show":J.isShow,title:"请填写相关信息","form-input-el":J.formInputEl,"form-select-el":J.formSelectEl,"form-text-area-el":J.formTextAreaEl,"form-upload-el":J.formUploadEl,"form-time-and-number":J.formTimeAndNumber,onCloseDialog:l[4]||(l[4]=e=>J.isShow=!1),onEmitOpenDialog:J.emitOpenDialog,onInputDone:J.inputDone},{append:(0,a.w5)((()=>["EQUATION"===re.value.collectType?((0,a.wg)(),(0,a.iD)("div",E,[(0,a.Wm)(ee,{key:"expression",label:"计算公式",prop:"expression",class:"mr10",style:{width:"85%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(X,{modelValue:re.value.expression,"onUpdate:modelValue":l[3]||(l[3]=e=>re.value.expression=e),type:"textarea",placeholder:"请编写计算公式",autosize:{minRows:3,maxRows:6}},null,8,["modelValue"])])),_:1}),(0,a.Wm)(se,{type:"info",onClick:oe},{default:(0,a.w5)((()=>[(0,a.Uk)(" 构造公式 ")])),_:1})])):(0,a.kq)("",!0)])),_:1},8,["loading","form-data","is-show","form-input-el","form-select-el","form-text-area-el","form-upload-el","form-time-and-number","onEmitOpenDialog","onInputDone"])):(0,a.kq)("",!0),ne.isShow?((0,a.wg)(),(0,a.j4)(i.Z,{key:3,ref:"dialogSearch","use-choose":!1,"append-table-style":{background:"#126f9e",color:"#fff",borderColor:"rgba(192, 192, 192,.5)"},width:"60%","search-input-placeholder":ne.searchPlaceholde,"is-show":ne.isShow,"data-source":ne.dataSource,title:"选择数据","is-show-search-input":"",loading:(0,r.SU)(p.V),onCloseDialog:l[5]||(l[5]=e=>ne.isShow=!1),onDoDialogSearch:ne.doSearch,onChooseRow:ne.chooseRow},null,8,["append-table-style","search-input-placeholder","is-show","data-source","loading","onDoDialogSearch","onChooseRow"])):(0,a.kq)("",!0),(0,a.Wm)(d.default,{"is-show":ae.value,list:he.value,"default-expresion":re.value.expression,onInputDone:te,onCloseDialog:l[6]||(l[6]=e=>ae.value=!1)},null,8,["is-show","list","default-expresion"])])}}};var _=(0,t(40089).Z)(l,[["__scopeId","data-v-0f707f54"]])}}]);